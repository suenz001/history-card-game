/* style.css */

/* å…¨åŸŸè¨­å®š */
body {
    font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
    background-color: #2c3e50;
    color: white;
    text-align: center;
    margin: 0;
    padding: 10px;
    overflow-x: hidden;
}

.game-container { max-width: 1200px; margin: 0 auto; }

/* å€å¡Š */
#login-section, #user-info {
    background: #34495e; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
input[type="text"], input[type="email"], input[type="password"] {
    background: #ecf0f1; border: none; padding: 8px; border-radius: 4px; margin: 5px 0;
}

/* æŠ½å¡å€å¡Šä½ˆå±€ä¿®æ­£ */
.gacha-section {
    display: flex;
    justify-content: center;
    align-items: stretch;
    gap: 15px;
    margin-bottom: 20px;
    width: 100%;
}
.gacha-section button {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
}

/* æŒ‰éˆ• */
.btn-primary, .btn-secondary, .btn-mini, .btn-danger { cursor: pointer; border: none; border-radius: 5px; transition: transform 0.1s; }
.btn-primary { background-color: #e74c3c; color: white; padding: 10px 20px; font-size: 1em; margin: 5px; }
.btn-secondary { background-color: #f39c12; color: white; padding: 10px 20px; font-size: 1em; margin: 5px; }
.btn-mini { background-color: #27ae60; color: white; padding: 2px 8px; font-size: 0.9em; margin-left: 5px; border-radius: 50%; font-weight: bold; }
.btn-danger { background-color: #c0392b; color: white; padding: 10px 20px; font-size: 1.1em; margin: 5px; border: 2px solid #e74c3c; font-weight: bold; }
.btn-upgrade { background-color: #27ae60; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
.btn-star { background-color: #8e44ad; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }
.btn-disabled { background-color: #7f8c8d !important; cursor: not-allowed; opacity: 0.7; pointer-events: none; }
.btn-primary:active, .btn-secondary:active, .btn-mini:active, .btn-danger:active { transform: scale(0.95); }

/* ä½ˆå±€ */
.main-layout { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start; }
.game-area { flex: 2; min-width: 300px; width: 100%; }
.leaderboard-area { flex: 1; min-width: 250px; background: #2c3e50; border: 2px solid #7f8c8d; padding: 15px; border-radius: 10px; width: 100%; }
.status-bar { background: #34495e; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 1.1em; font-weight: bold; }

/* æ’è¡Œæ¦œå„ªåŒ– */
.rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #555; font-size: 0.95em; align-items: center; }
.rank-item:last-child { border-bottom: none; }
.rank-item span:nth-child(1) { flex: 2; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.rank-item span:nth-child(2) { flex: 1; text-align: right; color: #bdc3c7; }
.rank-item:nth-child(1) span:nth-child(1) { color: #f1c40f; font-weight: bold; text-shadow: 0 0 5px gold; } 
.rank-item:nth-child(2) span:nth-child(1) { color: #bdc3c7; font-weight: bold; text-shadow: 0 0 5px silver; }
.rank-item:nth-child(3) span:nth-child(1) { color: #e67e22; font-weight: bold; text-shadow: 0 0 5px #d35400; }

/* å¡ç‰‡ */
.card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
.card {
    width: 120px; height: 180px; position: relative; background: #000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5); transition: transform 0.2s; border-radius: 8px; 
    cursor: pointer; touch-action: manipulation; box-sizing: border-box;
}
@media (max-width: 600px) { .card { width: 100px; height: 150px; } .status-bar { font-size: 0.9em; } }
.card:hover { transform: translateY(-5px); z-index: 50; }
.card-img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; position: absolute; top: 0; left: 0; z-index: 1; }
.card-frame-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; object-fit: fill; background: transparent; }

/* å¡ç‰‡è³‡è¨Š */
.card-info-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%; 
    background: linear-gradient(to top, rgba(0,0,0,0.95) 15%, rgba(0,0,0,0.7) 50%, transparent 100%);
    color: white; padding: 5px 0; text-align: center; border-radius: 0 0 8px 8px; 
    z-index: 20; pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; min-height: 40%; 
}
.card-title { font-size: 0.65em; color: #bdc3c7; margin-bottom: 1px; text-shadow: 1px 1px 2px #000; letter-spacing: 1px; }
.card-name { font-size: 0.9em; font-weight: bold; color: #fff; margin-bottom: 2px; text-shadow: 0 0 5px #000, 1px 1px 2px black; line-height: 1.1; }
.card-stats { font-size: 0.75em; color: #f1c40f; display: flex; justify-content: center; gap: 4px; flex-wrap: wrap; background: rgba(0,0,0,0.3); padding: 2px 0; margin-top: 2px; align-items: center;}
.card-level-star { font-size: 0.7em; color: #00d2d3; margin-bottom: 1px; }
.type-icon { font-size: 1.1em; margin-right: 2px; }

img[src=""], img:not([src]) { display: none; }

.card-id-badge {
    position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.7); color: #fff;
    padding: 2px 5px; border-radius: 4px; font-size: 0.7em; font-family: monospace; z-index: 15; pointer-events: none; border: 1px solid #777;
}
.card-rarity-badge {
    position: absolute; top: 5px; right: 5px; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold;
    z-index: 15; pointer-events: none; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 2px 4px rgba(0,0,0,0.5); font-family: Arial, sans-serif;
}
.card-rarity-badge.SSR { background: linear-gradient(45deg, #f1c40f, #f39c12); color: #000; }
.card-rarity-badge.SR { background: linear-gradient(45deg, #9b59b6, #8e44ad); color: #fff; }
.card-rarity-badge.R { background: linear-gradient(45deg, #3498db, #2980b9); color: #fff; }

/* å½ˆçª— */
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
.modal-content { background: #2c3e50; width: 90%; max-width: 1000px; height: 80%; border-radius: 10px; border: 2px solid #f1c40f; display: flex; flex-direction: column; padding: 20px; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #555; padding-bottom: 10px; }
#inventory-grid { flex: 1; overflow-y: auto; padding: 10px; }
.filter-bar { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
.filter-btn { background: transparent; border: 2px solid #ddd; color: #ddd; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; }
.filter-btn:hover { background: rgba(255,255,255,0.1); }
.filter-btn.active { background: #fff; color: #2c3e50 !important; border-color: #fff !important; }
.sort-dropdown { background: #34495e; color: white; border: 1px solid #7f8c8d; padding: 5px; border-radius: 5px; font-size: 0.9em; }

/* é€šçŸ¥åˆ—è¡¨æ¨£å¼ */
.notification-item { background: #34495e; border: 1px solid #7f8c8d; padding: 15px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
.notification-item:hover { background: #2c3e50; border-color: #f1c40f; }
.notification-item.claimed { opacity: 0.5; filter: grayscale(1); pointer-events: none; border-color: #555; }
.notif-title { font-weight: bold; font-size: 1.1em; color: #f1c40f; }
.notif-status { font-size: 0.9em; background: #e74c3c; padding: 3px 8px; border-radius: 4px; }
.notification-item.claimed .notif-status { background: #7f8c8d; }

/* è¨­å®š */
.settings-body { text-align: left; padding: 10px; }
.setting-item { margin-bottom: 15px; }
.setting-item label { display: block; font-weight: bold; margin-bottom: 5px; color: #f1c40f; }
.control-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
input[type="range"] { accent-color: #e67e22; cursor: pointer; }
input[type="checkbox"] { transform: scale(1.5); cursor: pointer; }

/* å¤§å¡ç‰‡ */
.large-card-container { perspective: 1000px; }
.large-card { width: 300px; height: 450px; position: relative; border-radius: 15px; box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); animation: popIn 0.3s ease-out; }
.large-card .card-title { font-size: 1.2em; margin-bottom: 5px; }
.large-card .card-name { font-size: 2em; margin-bottom: 5px; }
.large-card .card-stats { font-size: 1.4em; padding: 5px; }
.large-card .card-info-overlay { min-height: 30%; background: linear-gradient(to top, rgba(0,0,0,0.9) 20%, transparent 100%); }
.large-card.ssr-effect::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 150%; height: 150%; background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(0,0,0,0) 70%); animation: rotate-glow 5s linear infinite; z-index: -1; }
@media (max-width: 600px) { .large-card { width: 240px; height: 360px; } }
.large-card .card-level-star { font-size: 1em; color: #00d2d3; margin-top: 5px; display: block;}
.large-card .card-id-badge { font-size: 1.2em; padding: 5px 10px; top: 10px; left: 10px; }
.large-card .card-img, .large-card .card-frame-img { border-radius: 15px; }

.upgrade-controls { display: flex; gap: 10px; margin-top: 20px; z-index: 102; width: 100%; max-width: 320px; }
.upgrade-box { flex: 1; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px; border: 1px solid #555; display: flex; flex-direction: column; justify-content: space-between; }
.upgrade-title { font-size: 0.9em; color: #f1c40f; margin-bottom: 5px; font-weight: bold; }

.nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0, 0, 0, 0.3); color: white; border: 2px solid rgba(255,255,255,0.5); font-size: 2em; width: 50px; height: 50px; padding: 0; cursor: pointer; border-radius: 50%; user-select: none; z-index: 101; display: flex; align-items: center; justify-content: center; line-height: 1; }
.nav-arrow.left { left: 20px; }
.nav-arrow.right { right: 20px; }
.btn-close-circle { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5); color: white; border: 2px solid white; width: 40px; height: 40px; border-radius: 50%; font-size: 1.2em; cursor: pointer; z-index: 102; }

/* æ‰¹é‡åˆ†è§£ */
.card.is-selected { border: 3px solid #e74c3c !important; transform: translateY(-5px); box-shadow: 0 0 15px rgba(231, 76, 60, 0.6); }
.card.is-selected::after { content: 'âœ”'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3em; color: #e74c3c; border: 3px solid #e74c3c; border-radius: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.7); z-index: 50; pointer-events: none; }
#batch-toggle-btn { background-color: #34495e; border: 2px solid #95a5a6; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-left: 10px; transition: 0.3s; }
#batch-toggle-btn.active { background-color: #e74c3c; border-color: #c0392b; box-shadow: 0 0 10px #e74c3c; }
#batch-action-bar { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(44, 62, 80, 0.95); border: 2px solid #e74c3c; padding: 10px 20px; border-radius: 50px; display: flex; align-items: center; gap: 15px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 90%; max-width: 500px; justify-content: space-between; }
#batch-info { font-size: 1.1em; font-weight: bold; color: #fff; }
#batch-confirm-btn { background: #e74c3c; color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 1em; }
#batch-confirm-btn:hover { background: #c0392b; }

/* ğŸ”¥ æˆ°é¬¥ä¸­ï¼šå·²éƒ¨ç½²å¡ç‰‡æ¨£å¼ ğŸ”¥ */
.card.is-deployed { filter: grayscale(1) brightness(0.6); pointer-events: none; border-color: #7f8c8d !important; }
.card.is-deployed::after { content: 'å·²éƒ¨ç½²'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.2em; font-weight: bold; color: white; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; white-space: nowrap; z-index: 30; }

/* CSS ç´”è‰²é‚Šæ¡† */
.card { border: 2px solid #555; }
.card.R { border-color: #3498db; box-shadow: 0 0 5px rgba(52, 152, 219, 0.3); }
.card.SR { border-color: #9b59b6; box-shadow: 0 0 8px rgba(155, 89, 182, 0.5); }
.card.SSR { border-color: #f1c40f; box-shadow: 0 0 15px rgba(241, 196, 15, 0.8); animation: goldPulse 1.5s infinite alternate; }

/* SSR ç‰¹æ•ˆå‹•ç•« */
@keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
@keyframes rotate-glow { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
@keyframes goldPulse { from { box-shadow: 0 0 10px rgba(241, 196, 15, 0.5); } to { box-shadow: 0 0 25px rgba(241, 196, 15, 1); } }
#gacha-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
#summon-circle { width: 150px; height: 150px; border-radius: 50%; background: white; box-shadow: 0 0 20px white; animation: pulse 0.8s infinite alternate; z-index: 1001; }
.glow-r { background: #3498db !important; box-shadow: 0 0 30px #3498db !important; }
.glow-sr { background: #9b59b6 !important; box-shadow: 0 0 40px #9b59b6 !important; animation: pulse 0.5s infinite alternate !important; }
.glow-ssr { background: #f1c40f !important; box-shadow: 0 0 80px #f1c40f, 0 0 150px orange, 0 0 200px red !important; animation: superShake 0.1s infinite !important; }
#summon-burst { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 0; height: 0; border-radius: 50%; background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,215,0,0.8) 40%, transparent 80%); opacity: 0; z-index: 1000; }
.burst-active { animation: holyBurst 1s forwards ease-out; }
@keyframes pulse { from { transform: scale(1); opacity: 0.8; } to { transform: scale(1.2); opacity: 1; } }
@keyframes superShake { 0% { transform: translate(2px, 2px) rotate(0deg); } 25% { transform: translate(-2px, -2px) rotate(-2deg); } 50% { transform: translate(2px, -2px) rotate(2deg); } 75% { transform: translate(-2px, 2px) rotate(-2deg); } 100% { transform: translate(2px, 2px) rotate(0deg); } }
@keyframes holyBurst { 0% { width: 0; height: 0; opacity: 1; } 50% { width: 200vw; height: 200vw; opacity: 0.8; } 100% { width: 300vw; height: 300vw; opacity: 0; } }
.flash-screen { animation: flash 1.5s forwards; background: white !important; z-index: 2000; }
@keyframes flash { 0% { background: rgba(0,0,0,0.9); } 20% { background: white; opacity: 1; } 100% { background: rgba(0,0,0,0); opacity: 0; display: none; } }
.hidden { display: none !important; }

/* --- âš”ï¸ æˆ°é¬¥ç³»çµ±æ¨£å¼ (ä¸‰ç·šç‰ˆ) --- */
#battle-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #2c3e50; z-index: 1500; display: flex; flex-direction: column; }
.battle-header { background: rgba(0,0,0,0.8); padding: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); z-index: 101; }
.battle-info { font-weight: bold; color: #f1c40f; display: flex; gap: 15px; font-size: 0.9em; }

/* æˆ°å ´å®¹å™¨ */
.battle-field-container {
    flex: 1; position: relative; background: #34495e; overflow: hidden; border-top: 2px solid #555; border-bottom: 2px solid #555;
    background-image: linear-gradient(#2c3e50 1px, transparent 1px), linear-gradient(90deg, #2c3e50 1px, transparent 1px);
    background-size: 40px 40px; background-color: #1a252f;
}

/* ä¸»å ¡ (æ”¹ç‚ºå‡ºæ“Šç·š) */
.spawn-line { position: absolute; top: 0; bottom: 0; width: 5px; border-right: 2px dashed rgba(255,255,255,0.2); }
.spawn-line.left { left: 10px; }

.base-health-bar { display: none; } /* éš±è—è¡€æ¢ */

/* ä¸‰æ¢è·¯ç·š */
.lanes-wrapper { flex: 1; display: flex; flex-direction: column; height: 100%; }
.lane-row { flex: 1; display: flex; justify-content: space-around; align-items: center; border-bottom: 1px dashed rgba(255,255,255,0.1); position: relative; }
.lane-row:last-child { border-bottom: none; }

/* é˜²ç¦¦æ§½ä½ */
.defense-slot { width: 70px; height: 90px; border: 2px dashed #7f8c8d; border-radius: 6px; background: rgba(255,255,255,0.05); display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; transition: 0.2s; cursor: pointer; }
.defense-slot.active { border-style: solid; border-color: #f1c40f; background: rgba(241, 196, 15, 0.1); }
.defense-slot .card { transform: scale(0.45); pointer-events: none; margin: 0; border-width: 2px; box-shadow: none; position: absolute; top: 50%; left: 50%; translate: -50% -50%; } 
.slot-placeholder { color: #aaa; font-size: 0.8em; text-align: center; pointer-events: none; }

/* æ•µäººå‡ºç”Ÿå€ */
.enemy-spawn-zone { width: 50px; height: 100%; background: rgba(0,0,0,0.3); border-left: 4px dashed #c0392b; display: flex; justify-content: center; align-items: center; color: #e74c3c; font-weight: bold; writing-mode: vertical-lr; z-index: 10; }

/* ğŸ”¥ è‹±é›„å–®ä½ (è·‘å‹•ä¸­) - 2å€åŒ–ä¿®æ­£ ğŸ”¥ */
.hero-unit { 
    position: absolute; 
    width: 90px; /* 45px * 2 */
    height: 90px; /* 45px * 2 */
    border-radius: 50%; 
    border: 4px solid #fff; /* é‚Šæ¡†åŠ ç²— */
    display: flex; justify-content: center; align-items: center; 
    font-size: 1.2em; z-index: 20; 
    transition: left 0.1s linear; 
    box-shadow: 0 0 10px rgba(0,0,0,0.5); 
    transform: translateY(-50%); 
    background-size: cover; 
    background-position: center 15%;
}
.hero-unit.SSR { border-color: #f1c40f; }
.hero-unit.SR { border-color: #9b59b6; }
.hero-unit.R { border-color: #3498db; }

/* ğŸ”¥ ä¿®æ­£ï¼šè¡€æ¢åŠ å…¥ç½®ä¸­è¨­å®šï¼Œé˜²æ­¢è½‰å‘æ™‚äº‚è·‘ ğŸ”¥ */
.hero-hp-bar, .enemy-hp-bar { 
    position: absolute; 
    top: -24px; /* å¾€ä¸Šç§»ï¼Œç•™ç©ºé–“çµ¦æ°£åŠ›æ¢ */
    width: 70px; /* 35px * 2 */
    height: 8px; /* 4px * 2 */
    background: #555; 
    border-radius: 4px; 
    /* å¼·åˆ¶ç½®ä¸­ */
    left: 50%;
    transform: translateX(-50%);
}
.hero-hp-bar > div { height: 100%; background: #2ecc71; border-radius: 4px; }
.enemy-hp-bar > div { height: 100%; background: #e74c3c; border-radius: 4px; }

/* ğŸ”¥ ä¿®æ­£ï¼šæ°£åŠ›æ¢åŠ å…¥ç½®ä¸­è¨­å®š ğŸ”¥ */
.hero-mana-bar {
    position: absolute;
    top: -12px; /* ä½æ–¼è¡€æ¢ä¸‹æ–¹ */
    width: 70px; /* 35px * 2 */
    height: 8px; /* 4px * 2 */
    background: #333;
    border-radius: 4px;
    overflow: hidden;
    z-index: 25;
    /* å¼·åˆ¶ç½®ä¸­ */
    left: 50%;
    transform: translateX(-50%);
}

.hero-mana-bar > div {
    height: 100%;
    background: #3498db; /* è—è‰² */
    width: 0%;
    transition: width 0.2s linear;
}

/* ğŸ”¥ æ°£åŠ›å…¨æ»¿æ™‚çš„ç™¼å…‰ç‰¹æ•ˆ (ä¿®æ”¹ç‚ºå¤–åœˆæ©˜å…‰) */
/* ä½¿ç”¨å½å…ƒç´ è£½ä½œå¤–åœˆï¼Œä¸è¦†è“‹åŸæœ¬çš„ border-color */
.hero-unit.mana-full::after {
    content: '';
    position: absolute;
    /* è¨­å®šæ¯”åŸæœ¬å¤§ä¸€åœˆ */
    top: -15px; 
    left: -15px; 
    right: -15px; 
    bottom: -15px;
    border-radius: 50%;
    
    /* æ©˜è‰²å…‰åœˆ */
    border: 3px solid #e67e22; 
    box-shadow: 0 0 15px #e67e22, inset 0 0 5px #f39c12; 
    
    /* ç¢ºä¿ä½æ–¼åœ–å±¤æœ€ä¸‹æ–¹ï¼Œä¸é®æ“‹ç¨€æœ‰åº¦æ¡† */
    z-index: -1; 
    
    animation: manaRingPulse 0.6s infinite alternate;
}

@keyframes manaRingPulse {
    from { transform: scale(0.95); opacity: 0.7; }
    to { transform: scale(1.1); opacity: 1; }
}

/* ğŸ”· æŠ€èƒ½ç™¼å‹•æ™‚çš„é£„å­—ç‰¹æ•ˆ (ç¨±è™Ÿ) */
.damage-text.skill-title {
    color: #f1c40f; /* é‡‘è‰²å­—é«” */
    font-size: 1.5em;
    font-weight: 900;
    text-shadow: 
        0 0 5px #e74c3c,
        0 0 10px #c0392b,
        2px 2px 0px #000;
    z-index: 300;
    animation: skillFloat 1.2s forwards;
    white-space: nowrap;
}

@keyframes skillFloat {
    0% { transform: translateY(0) scale(0.5); opacity: 0; }
    20% { transform: translateY(-20px) scale(1.5); opacity: 1; }
    80% { transform: translateY(-40px) scale(1); opacity: 1; }
    100% { transform: translateY(-50px) scale(0.8); opacity: 0; }
}

/* æ•µäººå¯¦é«” - 2å€åŒ–ä¿®æ­£ */
.enemy-unit { 
    position: absolute; 
    width: 90px; /* 40px * 2 + èª¿æ•´ */
    height: 90px; 
    background: #e74c3c; 
    border-radius: 50%; 
    border: 4px solid #fff; 
    display: flex; justify-content: center; align-items: center; 
    font-size: 1.2em; z-index: 5; 
    transition: left 0.1s linear; 
    box-shadow: 0 0 10px rgba(0,0,0,0.5); 
    transform: translateY(-50%); 
}

/* ğŸ”¥ é­”ç‹æ¨£å¼ - å·¨å¤§åŒ–ä¿®æ­£ */
.enemy-unit.boss { 
    width: 200px !important;  /* åŸæœ¬ 110px -> 200px */
    height: 200px !important;
    background: rgba(0,0,0,0.6);
    border-radius: 5px; /* å¾®å¾®åœ“è§’çš„æ­£æ–¹å½¢ */
    z-index: 50;
    font-size: 5em; /* Emoji è®Šå¤§ */
    
    /* ç§»é™¤èˆŠé‚Šæ¡†ï¼Œæ”¹ç”¨å½å…ƒç´  */
    border: none; 
    box-shadow: 0 0 30px #c0392b; 

    /* ä¿æŒ flex è®“ Emoji å±…ä¸­ */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* æ—‹è½‰å¤–æ¡† - å…§å±¤ */
.enemy-unit.boss::before {
    content: '';
    position: absolute;
    top: -15px; left: -15px; right: -15px; bottom: -15px;
    border: 4px dashed #8e44ad; /* ç´«è‰²è™›ç·š */
    border-radius: 5px;
    box-shadow: 0 0 20px #8e44ad;
    animation: bossSpin 4s linear infinite;
    z-index: -1;
}

/* æ—‹è½‰å¤–æ¡† - å¤–å±¤ (å¢åŠ å¨åŠ›æ„Ÿ) */
.enemy-unit.boss::after {
    content: '';
    position: absolute;
    top: -25px; left: -25px; right: -25px; bottom: -25px;
    border: 3px solid #f1c40f; /* é‡‘è‰²å¤–æ¡† */
    border-radius: 5px;
    box-shadow: 0 0 30px #f1c40f;
    animation: bossSpin 6s linear infinite reverse; /* åå‘æ—‹è½‰ */
    z-index: -2;
}

/* ğŸ”¥ é­”ç‹è¡€æ¢ä½ç½®èª¿æ•´ - 2å€åŒ–ä¿®æ­£ & åŠ å…¥ç½®ä¸­ */
.enemy-unit.boss .enemy-hp-bar { 
    top: -40px; 
    width: 180px; 
    height: 14px; 
    border: 2px solid rgba(255,255,255,0.8);
    /* å¼·åˆ¶ç½®ä¸­ */
    left: 50%;
    transform: translateX(-50%);
}

/* æ—‹è½‰å‹•ç•«å®šç¾© */
@keyframes bossSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* åº•éƒ¨ */
.battle-deck { background: #2c3e50; border-top: 2px solid #f1c40f; padding: 10px; display: flex; flex-direction: column; }
.difficulty-btn { border: none; padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; cursor: pointer; opacity: 0.5; transition: 0.2s; }
.difficulty-btn.active { opacity: 1; transform: scale(1.1); box-shadow: 0 0 10px white; }

/* å‚·å®³é£„å­— - åŸºç¤æ¨£å¼ */
.damage-text { position: absolute; font-weight: bold; font-size: 1.2em; text-shadow: 0 0 3px #000; pointer-events: none; z-index: 100; animation: floatUp 0.8s forwards; color: #fff; }

/* å‚·å®³é£„å­— - é¡è‰²è®Šé«” */
.damage-text.hero-dmg { 
    color: #ffffff; 
    font-size: 1.6em; 
    text-shadow: 
        2px 0 0 #000, -2px 0 0 #000, 
        0 2px 0 #000, 0 -2px 0 #000, 
        1px 1px #000, -1px -1px #000, 
        1px -1px #000, -1px 1px #000;
    font-weight: 900;
    z-index: 200;
}
.damage-text.enemy-dmg { color: #e74c3c; font-size: 1.3em; }
.damage-text.gold-text { color: #f39c12; font-size: 1.2em; text-shadow: 0 0 5px gold; }

@keyframes floatUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-30px); opacity: 0; } }

/* ğŸ”¥ é£›è¡Œé“å…· (Projectile) ğŸ”¥ */
.projectile {
    position: absolute;
    z-index: 50;
    transition: all 0.3s linear;
    pointer-events: none;
    font-size: 2em;
    filter: drop-shadow(0 0 5px white);
}
/* ğŸ”¥ é­”ç‹æŠ•å°„ç‰© (ç«çƒ/æš—é»‘çƒ) */
.boss-projectile {
    position: absolute; z-index: 60;
    width: 30px; height: 30px;
    background: radial-gradient(circle, #fff, #4a0072);
    border-radius: 50%;
    box-shadow: 0 0 15px #8e44ad;
    transition: all 0.5s linear;
    pointer-events: none;
    animation: spin 0.5s linear infinite;
}
@keyframes spin { 100% { transform: rotate(360deg); } }

/* ğŸ”¥ å™´æ¯’å‹•ç•« */
.poison-effect {
    position: absolute; width: 100px; height: 100px; 
    background: radial-gradient(circle, #00ff00, transparent); 
    border-radius: 50%; opacity: 0.9; z-index: 99; pointer-events: none;
    transform: translate(-50%, -50%);
    animation: poisonSplash 0.5s forwards;
}
@keyframes poisonSplash {
    0% { transform: translate(-50%, -50%) scale(0.2); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* ğŸ”¥ é­”ç‹ AoE ç‰¹æ•ˆ */
.boss-aoe-effect {
    position: absolute; width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(142, 68, 173, 0.8), transparent 70%);
    border-radius: 50%;
    z-index: 99; pointer-events: none;
    transform: translate(-50%, -50%);
    animation: bossExplosion 0.6s ease-out forwards;
}
@keyframes bossExplosion {
    0% { transform: translate(-50%, -50%) scale(0.1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* å—å‚·éœ‡å‹• */
.card.taking-damage {
    animation: cardDamageShake 0.4s ease-out;
}
@keyframes cardDamageShake {
    0% { transform: translate(-50%, -50%) scale(0.45) rotate(0deg); filter: none; }
    20% { transform: translate(-55%, -50%) scale(0.5) rotate(-10deg); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.5); }
    40% { transform: translate(-45%, -50%) scale(0.45) rotate(10deg); }
    60% { transform: translate(-55%, -50%) scale(0.5) rotate(-10deg); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.5); }
    100% { transform: translate(-50%, -50%) scale(0.45) rotate(0deg); filter: none; }
}

.hero-unit.taking-damage, .enemy-unit.taking-damage {
    animation: unitDamageShake 0.4s ease-out;
}
@keyframes unitDamageShake {
    0% { transform: translateY(-50%) scale(1) rotate(0deg); filter: none; }
    20% { transform: translateY(-50%) scale(0.9) rotate(-10deg); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.5); }
    40% { transform: translateY(-50%) scale(1.05) rotate(10deg); }
    60% { transform: translateY(-50%) scale(0.9) rotate(-10deg); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.5); }
    100% { transform: translateY(-50%) scale(1) rotate(0deg); filter: none; }
}

/* è¢å¹•éœ‡å‹• */
@keyframes shakeScreen { 0% { transform: translate(0, 0); } 25% { transform: translate(-5px, 5px); } 50% { transform: translate(5px, -5px); } 75% { transform: translate(-5px, -5px); } 100% { transform: translate(0, 0); } }
.shake-screen-effect { animation: shakeScreen 0.3s ease-in-out; }

/* å‹•æ…‹è¡€æ¢é¡è‰² */
.hp-low { background: #e74c3c !important; box-shadow: 0 0 5px #c0392b; } 
.hp-mid { background: #f1c40f !important; }

/* æˆ°é¬¥çµç®—å½ˆçª— */
#battle-result-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 3000; display: flex; justify-content: center; align-items: center; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.result-content { background: #2c3e50; border: 4px solid #f1c40f; border-radius: 15px; padding: 30px; text-align: center; width: 300px; box-shadow: 0 0 50px rgba(241, 196, 15, 0.5); }
.result-title { font-size: 2.5em; margin-bottom: 10px; font-weight: bold; }
.result-gold { font-size: 1.5em; color: #f1c40f; margin-bottom: 20px; }
.win-text { color: #2ecc71; text-shadow: 0 0 10px #2ecc71; }
.lose-text { color: #e74c3c; text-shadow: 0 0 10px #e74c3c; }

/* æ³¢æ¬¡æç¤º */
#wave-notification {
    position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%);
    font-size: 3em; font-weight: bold; color: #e74c3c; text-shadow: 0 0 20px black; z-index: 100;
    animation: waveFade 2s forwards; pointer-events: none;
}
@keyframes waveFade { 0% { opacity: 0; transform: translate(-50%, -30%); } 20% { opacity: 1; transform: translate(-50%, -50%); } 80% { opacity: 1; } 100% { opacity: 0; } }

/* ä¸»å ¡é›·å°„ */
.base-laser {
    position: absolute; top: 50%; left: 80px; width: 0; height: 4px; background: #00ffff; box-shadow: 0 0 10px #00ffff; z-index: 9;
    transform-origin: left center; animation: laserShoot 0.2s forwards;
}
@keyframes laserShoot { 0% { opacity: 1; } 100% { opacity: 0; } }

/* DPS è¡¨ */
.dps-container {
    margin-top: 15px; background: #222; padding: 10px; border-radius: 5px; text-align: left;
    max-height: 200px; overflow-y: auto;
}
.dps-row {
    display: flex; align-items: center; margin-bottom: 8px;
}
.dps-icon {
    width: 30px; height: 30px; border-radius: 50%; background-size: cover; margin-right: 10px; flex-shrink: 0;
}
.dps-bar-container {
    flex: 1;
}
.dps-info {
    display: flex; justify-content: space-between; font-size: 0.8em; margin-bottom: 2px;
}
.dps-bar-bg {
    width: 100%; height: 6px; background: #555; border-radius: 3px; overflow: hidden;
}
.dps-bar-fill {
    height: 100%; background: #f1c40f; transition: width 0.5s ease-out;
}

/* ğŸ”¥ ä¿®æ­£ 1ï¼šå…µç¨®åœ–ç¤ºæ”¹åˆ°å³ä¸‹è§’ï¼Œé¿å…æ“‹ä½äººç‰© - 2å€åŒ–ä¿®æ­£ */
.hero-type-badge {
    position: absolute; 
    bottom: -5px; 
    right: -5px; 
    top: auto;
    width: 32px; height: 32px; /* è®Šå¤§ */
    background: #3498db; border-radius: 50%; 
    font-size: 18px; /* å­—é«”è®Šå¤§ */
    display: flex; justify-content: center; align-items: center; color: white;
    z-index: 25;
    border: 2px solid white; /* å¢åŠ ç™½é‚Š */
}

/* ğŸ”¥ æ–°å¢ï¼šé ç¨‹å…µç¨®åœ–ç¤ºæ”¹ç‚ºç´…è‰² */
.hero-type-badge.ranged {
    background-color: #e74c3c;
}

/* æˆ°é¬¥å…§å®¹å®¹å™¨ */
.battle-content-wrapper {
    position: relative; 
    overflow: hidden; 
}

/* ä¿®æ”¹æˆ°é¬¥å´é‚Šæ¬„ï¼šåŠ å…¥éæ¸¡å‹•ç•« */
.battle-monitor-sidebar {
    width: 180px; 
    background: #222; 
    border-left: 1px solid #444; 
    padding: 10px; 
    overflow-y: auto;
    display: flex; 
    flex-direction: column; 
    gap: 8px;
    transition: width 0.3s ease, padding 0.3s ease;
    flex-shrink: 0;
}

.monitor-item {
    display: flex; align-items: center; gap: 8px; background: #333; padding: 5px; border-radius: 5px;
}
.monitor-item.dead { opacity: 0.4; filter: grayscale(1); }
.monitor-icon { width: 30px; height: 30px; border-radius: 50%; background-size: cover; flex-shrink: 0; border: 1px solid #777; }
.monitor-info { flex: 1; display: flex; flex-direction: column; gap: 2px; }
.monitor-name { font-size: 0.75em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.monitor-hp-bg { width: 100%; height: 6px; background: #555; border-radius: 3px; overflow: hidden; }
.monitor-hp-fill { height: 100%; background: #2ecc71; transition: width 0.2s; width: 100%; }

/* ğŸ”¥ æ–°å¢ï¼šå´é‚Šæ¬„æ°£åŠ›æ¢ */
.monitor-mana-bg {
    width: 100%; height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin-top: 2px;
}
.monitor-mana-fill {
    height: 100%; background: #3498db; width: 0%; transition: width 0.2s;
}

/* ğŸ”¥ æ–°å¢ï¼šå´é‚Šæ¬„æ‘ºç–Šç‹€æ…‹ */
.battle-monitor-sidebar.collapsed {
    width: 0;
    padding: 10px 0; 
    border-left: none;
    overflow: hidden;
}

/* ğŸ”¥ æ–°å¢ï¼šå´é‚Šæ¬„åˆ‡æ›æŒ‰éˆ• */
#toggle-sidebar-btn {
    position: absolute;
    right: 180px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 60px;
    background: #34495e;
    border: 1px solid #7f8c8d;
    border-right: none;
    border-radius: 10px 0 0 10px;
    color: #f1c40f;
    font-size: 1.2em;
    cursor: pointer;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: right 0.3s ease;
    padding: 0;
}

#toggle-sidebar-btn:hover {
    background: #2c3e50;
    color: white;
}

.battle-monitor-sidebar.collapsed + #toggle-sidebar-btn,
#toggle-sidebar-btn.collapsed-pos {
    right: 0;
    border-right: 1px solid #7f8c8d;
    border-left: none;
    border-radius: 10px 0 0 10px;
}

/* =========================================
   === PVP åŠŸèƒ½æ¨£å¼ ===
   ========================================= */

/* PVP VS ä»‹é¢ */
.vs-container {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 10px; margin-bottom: 20px;
}
.player-card { text-align: center; flex: 1; }
.player-card.self { color: #3498db; }
.player-card.enemy { color: #e74c3c; }
.p-name { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
.p-power { font-size: 1.2em; color: #f1c40f; }

/* PVP æ ¼å­æ¨£å¼èª¿æ•´ */
.pvp-grid-container { display: flex; flex-direction: column; gap: 5px; }
.pvp-grid-container .defense-slot { width: 50px; height: 50px; margin-right: 10px; }
.pvp-grid-container .lane-row { height: auto; padding: 5px; border: none; justify-content: center; }

/* é€²æ”»/é˜²å®ˆä¸åŒè‰² */
.pvp-defense-slot { border-color: #f1c40f; }
.pvp-attack-slot { border-color: #3498db; }

/* å°æ‰‹åˆ—è¡¨æ¨£å¼ */
.opponent-list-container { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
.opponent-list-item {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(255,255,255,0.1); padding: 10px 15px; border-radius: 8px;
    border: 1px solid #555; transition: 0.2s;
}
.opponent-list-item:hover { background: rgba(255,255,255,0.2); border-color: #aaa; }
.opp-info { text-align: left; }
.opp-name { font-weight: bold; font-size: 1.1em; color: #ecf0f1; }
.opp-power { font-size: 0.9em; color: #f1c40f; }
.opp-tag { font-size: 0.8em; padding: 2px 5px; border-radius: 3px; margin-left: 5px; }
.tag-strong { background: #e74c3c; color: white; }
.tag-weak { background: #2ecc71; color: #2c3e50; }

/* æˆ°é¬¥æ—¥èªŒ (Battle Log) æ¨£å¼ */
.notif-battle-log {
    border-left: 5px solid #ccc;
}
.log-def-win {
    border-left-color: #2ecc71; /* ç¶ è‰²ï¼šé˜²å®ˆå‹åˆ© */
    background: rgba(46, 204, 113, 0.1);
}
.log-def-lose {
    border-left-color: #e74c3c; /* ç´…è‰²ï¼šé˜²å®ˆå¤±æ•— */
    background: rgba(231, 76, 60, 0.1);
}

/* =========================================
   === âš¡ æŠ€èƒ½ç‰¹æ•ˆ (æ–°å¢) ===
   ========================================= */

/* æ²»ç™‚å…‰ç’° */
.skill-effect-heal {
    position: absolute;
    width: 100px; height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(46, 204, 113, 0.5) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    pointer-events: none; z-index: 50;
    animation: skillHealAnim 1s ease-out forwards;
}
@keyframes skillHealAnim {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* æˆ°å¼ (Buff) */
.skill-effect-buff {
    position: absolute;
    width: 80px; height: 80px;
    border-radius: 50%;
    border: 2px solid #f1c40f;
    box-shadow: 0 0 10px gold;
    transform: translate(-50%, -50%);
    pointer-events: none; z-index: 50;
    animation: skillBuffAnim 0.8s ease-out forwards;
}
@keyframes skillBuffAnim {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* ç„¡æ•µè­·ç›¾ */
.invincible-shield {
    box-shadow: 0 0 15px gold, inset 0 0 10px gold !important;
    border-color: gold !important;
    animation: shieldPulse 0.5s infinite alternate !important;
}
@keyframes shieldPulse {
    from { opacity: 0.8; } to { opacity: 1; }
}

/* AoE çˆ†ç‚¸ */
.aoe-blast {
    position: absolute;
    width: 150px; height: 150px;
    background: radial-gradient(circle, rgba(231, 76, 60, 0.8) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    pointer-events: none; z-index: 100;
    animation: blastAnim 0.5s ease-out forwards;
}
@keyframes blastAnim {
    0% { transform: translate(-50%, -50%) scale(0.2); opacity: 1; }
    50% { opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; }
}

/* å…¨å ´è½Ÿç‚¸ */
.global-bomb-effect {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: white; opacity: 0;
    z-index: 2000; pointer-events: none;
    animation: globalFlash 0.3s ease-out;
}
@keyframes globalFlash {
    0% { opacity: 0.5; } 100% { opacity: 0; }
}

/* =========================================
   === ğŸ´ å¡ç‰‡ç¿»è½‰ç‰¹æ•ˆ (æ–°å¢) ===
   ========================================= */

/* å¤§å¡ç‰‡å®¹å™¨ (ç§»é™¤èƒŒæ™¯ï¼Œæ”¹ç‚º 3D ç©ºé–“) */
.large-card {
    background-color: transparent !important;
    perspective: 1000px; /* è¨­å®š 3D æ™¯æ·± */
    cursor: pointer;
    box-shadow: none !important; /* é™°å½±ç§»çµ¦å…§å±¤ */
    border: none !important; /* é‚Šæ¡†ç§»çµ¦å…§å±¤ */
}

/* å…§å±¤å®¹å™¨ (è² è²¬æ—‹è½‰) */
.large-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
    transform-style: preserve-3d;
    border-radius: 15px;
}

/* è§¸ç™¼ç¿»è½‰ */
.large-card.is-flipped .large-card-inner {
    transform: rotateY(180deg);
}

/* æ­£é¢èˆ‡èƒŒé¢å…±ç”¨è¨­å®š */
.large-card-front, .large-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden; /* éš±è—èƒŒé¢ */
    backface-visibility: hidden;
    border-radius: 15px;
    overflow: hidden;
    top: 0; left: 0;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5); /* çµ±ä¸€é™°å½± */
}

/* --- æ­£é¢è¨­å®š --- */
.large-card-front {
    background: #000;
    transform: rotateY(0deg);
    z-index: 2;
}

/* ä¿®æ­£ SSR å…‰æ•ˆåœ¨æ­£é¢é¡¯ç¤º */
.large-card-front.ssr-effect::before {
    content: ''; position: absolute; top: 50%; left: 50%; 
    transform: translate(-50%, -50%); width: 150%; height: 150%; 
    background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(0,0,0,0) 70%); 
    animation: rotate-glow 5s linear infinite; z-index: -1; 
}

/* --- èƒŒé¢è¨­å®š --- */
.large-card-back {
    background: linear-gradient(135deg, #34495e 0%, #1a252f 100%);
    color: white;
    transform: rotateY(180deg); /* é å…ˆæ—‹è½‰ 180 åº¦ */
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    border: 3px solid #7f8c8d;
    text-align: left;
    overflow-y: auto; /* å…§å®¹å¤šæ™‚å¯æ²å‹• */
}

/* èƒŒé¢ç¨€æœ‰åº¦é‚Šæ¡†é¡è‰² */
.large-card-back.SSR { border-color: #f1c40f; box-shadow: inset 0 0 30px rgba(241, 196, 15, 0.2); }
.large-card-back.SR { border-color: #9b59b6; box-shadow: inset 0 0 30px rgba(155, 89, 182, 0.2); }
.large-card-back.R { border-color: #3498db; box-shadow: inset 0 0 30px rgba(52, 152, 219, 0.2); }

/* èƒŒé¢å…§å®¹æ’ç‰ˆ */
.card-back-section { margin-bottom: 20px; }
.card-back-title {
    color: #f1c40f;
    font-size: 1.2em;
    font-weight: bold;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 5px;
    margin-bottom: 8px;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
    display: flex; align-items: center; gap: 5px;
}
.card-back-text {
    font-size: 0.95em;
    line-height: 1.6;
    color: #ecf0f1;
    text-shadow: 1px 1px 2px black;
}
.flip-hint {
    margin-top: auto;
    text-align: center;
    font-size: 0.8em;
    color: #95a5a6;
    animation: pulse 2s infinite;
}

/* --- style.css æ–°å¢ç‰¹æ•ˆå€ --- */

/* 1. æ–½æ³•æ™‚è‹±é›„çš„é›†æ°£ç™¼å…‰ç‰¹æ•ˆ */
.hero-casting {
    filter: brightness(1.5) drop-shadow(0 0 10px gold);
    transform: scale(1.1) !important;
    transition: all 0.2s ease-out;
    z-index: 100;
}

/* 2. å„ªåŒ–æŠ•å°„ç‰© (ç«çƒ/ç®­çŸ¢/åŠæ°£) */
.projectile {
    position: absolute;
    z-index: 999;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;
    will-change: left, top;
}

/* æŠ€èƒ½å…‰çƒ */
.proj-skill {
    font-size: 2.5em;
    filter: drop-shadow(0 0 15px #f1c40f);
    animation: spin 0.5s linear infinite;
}

/* 3. è¢å¹•éœ‡å‹•ç‰¹æ•ˆ (æ‰“æ“Šæ„Ÿæ ¸å¿ƒ) */
@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
}
.screen-shake {
    animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
}

/* 4. å…¨è¢å¹•é–ƒå…‰ (å¤§æ‹›ç”¨) */
.screen-flash-white {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: white; opacity: 0.8; z-index: 10000;
    pointer-events: none;
    animation: flashFade 0.4s forwards;
}
.screen-flash-dark {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: black; opacity: 0.7; z-index: 10000;
    pointer-events: none;
    animation: flashFade 0.6s forwards;
}
@keyframes flashFade { to { opacity: 0; } }

/* 5. å„ç¨®æŠ€èƒ½è½åœ°ç‰¹æ•ˆ (VFX) */
.vfx-container {
    position: absolute;
    pointer-events: none;
    z-index: 1000;
    transform: translate(-50%, -50%); /* ä¸­å¿ƒå°é½Š */
}

/* (A) çˆ†ç‚¸/è½Ÿç‚¸ */
.vfx-explosion {
    width: 120px; height: 120px;
    background: radial-gradient(circle, #f1c40f 10%, #e67e22 40%, transparent 70%);
    border-radius: 50%;
    animation: explodeAnim 0.5s ease-out forwards;
    filter: blur(2px);
}
@keyframes explodeAnim {
    0% { transform: scale(0.1); opacity: 1; }
    50% { opacity: 0.8; }
    100% { transform: scale(2.0); opacity: 0; }
}

/* (B) æ–¬æ“Š (æ–œå‘) */
.vfx-slash {
    width: 150px; height: 10px;
    background: white;
    box-shadow: 0 0 10px #e74c3c, 0 0 20px #c0392b;
    animation: slashAnim 0.3s ease-out forwards;
}
@keyframes slashAnim {
    0% { transform: scaleX(0) rotate(-45deg); opacity: 0; }
    20% { transform: scaleX(1) rotate(-45deg); opacity: 1; }
    100% { transform: scaleX(1.2) rotate(-45deg); opacity: 0; }
}

/* (C) æ²»ç™‚å…‰æŸ± */
.vfx-heal-pillar {
    width: 60px; height: 200px;
    background: linear-gradient(to top, rgba(46, 204, 113, 0.8), transparent);
    animation: healAnim 0.8s ease-out forwards;
}
@keyframes healAnim {
    0% { transform: scaleY(0); opacity: 0; }
    20% { transform: scaleY(1); opacity: 1; }
    100% { transform: scaleY(1.2) translateY(-20px); opacity: 0; }
}

/* (D) Buff å…‰ç’° */
.vfx-buff-ring {
    width: 100px; height: 100px;
    border: 5px solid #3498db;
    border-radius: 50%;
    box-shadow: 0 0 15px #3498db;
    opacity: 0;
    animation: buffAnim 0.8s ease-out forwards;
}
@keyframes buffAnim {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.0); opacity: 1; border-width: 5px; }
    100% { transform: scale(1.5); opacity: 0; border-width: 0px; }
}

/* (E) æ–¬æ®ºç‰¹æ•ˆ */
.vfx-execute {
    width: 200px; height: 200px;
    background: radial-gradient(circle, transparent 30%, #e74c3c 40%, transparent 50%);
    animation: executeAnim 0.6s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
}
@keyframes executeAnim {
    0% { transform: scale(0) rotate(0deg); opacity: 1; }
    100% { transform: scale(1.5) rotate(180deg); opacity: 0; }
}

@keyframes spin { 100% { transform: rotate(360deg); } }

/* æ•µæ–¹è¡€æ¢é¡è‰² (ç´…è‰²) */
.monitor-hp-fill.enemy {
    background: #e74c3c !important;
}

/* ç¢ºä¿å´é‚Šæ¬„å…§å®¹éå¤šæ™‚å¯ä»¥æ²å‹•ï¼Œä¸”æ¨™é¡Œä¸æœƒè¢«æ“ å£“ */
.battle-monitor-sidebar h3 {
    flex-shrink: 0;
}

/* é—œå¡é¸æ“‡ Grid */
.level-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    padding: 10px;
    overflow-y: auto;
}

.level-btn {
    background: #34495e;
    border: 2px solid #7f8c8d;
    color: white;
    padding: 20px 10px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100px;
}

.level-btn:hover {
    background: #2c3e50;
    border-color: #f1c40f;
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(241, 196, 15, 0.3);
}

.level-btn .level-name {
    margin-top: 5px;
    font-size: 1.1em;
    font-weight: bold;
    color: #f1c40f;
}

/* é–å®šçš„é—œå¡æ¨£å¼ (é ç•™ç”¨) */
.level-btn.locked {
    opacity: 0.6;
    filter: grayscale(1);
    /* cursor: not-allowed; */ /* ç›®å‰å…ˆä¸é–ï¼Œæ–¹ä¾¿æ¸¬è©¦ */
}

/* å¡ç‰‡èƒŒé¢å®¹å™¨ï¼šè¨­å®šç‚ºå½ˆæ€§ä½ˆå±€ï¼Œç¢ºä¿é«˜åº¦å›ºå®š */
.large-card-back {
    display: flex;
    flex-direction: column; /* å‚ç›´æ’åˆ— */
    justify-content: flex-start;
    align-items: center;
    padding: 20px 15px; /* å¢åŠ å…§è· */
    box-sizing: border-box;
    overflow: hidden; /* éš±è—è¶…å‡ºå®¹å™¨çš„éƒ¨åˆ†ï¼Œäº¤çµ¦å­å…ƒç´ æ²å‹• */
    height: 100%; /* ç¢ºä¿ä½”æ»¿æ•´å€‹å¡ç‰‡é«˜åº¦ */
}

/* ä¸ŠåŠéƒ¨ï¼šæŠ€èƒ½èªªæ˜ (å›ºå®šé«˜åº¦ï¼Œä¸æ²å‹•) */
.card-skill-section {
    flex: 0 0 auto; /* ä¸æœƒç¸®æ”¾ */
    width: 100%;
    margin-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    padding-bottom: 10px;
}

/* ä¸‹åŠéƒ¨ï¼šäººç‰©ç”Ÿå¹³ */
.card-bio-section {
    flex: 1;
    width: 100%;
    overflow-y: auto;
    
    /* ğŸ”¥ iOS ä¿®æ­£é—œéµ 1ï¼šé–‹å•Ÿæ…£æ€§æ²å‹• */
    -webkit-overflow-scrolling: touch; 
    
    /* ğŸ”¥ iOS ä¿®æ­£é—œéµ 2ï¼šè§£æ±º 3D ç¿»è½‰å¾Œç„¡æ³•æ²å‹•çš„ Bug */
    transform: translate3d(0,0,0);
    
    /* å…¶ä»–æ¨£å¼ */
    min-height: 0;
    text-align: left;
    padding-right: 5px;
    
    /* è®“é»æ“Šäº‹ä»¶å¯ä»¥ç©¿é€åˆ° JS åµæ¸¬ */
    pointer-events: auto; 
}

/* ç¢ºä¿èƒŒé¢å®¹å™¨çš„å±¤ç´šæ­£ç¢º */
.large-card-back {
    /* ...åŸæœ‰æ¨£å¼... */
    background: linear-gradient(135deg, #34495e 0%, #1a252f 100%);
    color: white;
    transform: rotateY(180deg);
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-sizing: border-box;
    border: 3px solid #7f8c8d;
    text-align: left;
    overflow: hidden; /* é€™è£¡è¨­ç‚º hiddenï¼Œæ²å‹•äº¤çµ¦ bio-section */
    height: 100%;
    
    /* ğŸ”¥ iOS ä¿®æ­£é—œéµ 3ï¼šç¢ºä¿èƒŒé¢åœ¨ç¿»è½‰å¾Œèƒ½æ¥æ”¶è§¸æ§ */
    z-index: 10; 
}

/* å„ªåŒ–æ²è»¸æ¨£å¼ (è®“å®ƒå¥½çœ‹ä¸€é») */
.card-bio-section::-webkit-scrollbar {
    width: 6px;
}
.card-bio-section::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}
.card-bio-section::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.4);
    border-radius: 3px;
}
.card-bio-section::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.6);
}

/* ç¢ºä¿æ¨™é¡Œæ¨£å¼æ¸…æ™° */
.card-back-title {
    color: #f1c40f;
    font-size: 1.1em;
    font-weight: bold;
    margin-bottom: 5px;
    text-align: center;
}

.card-back-text {
    font-size: 0.9em;
    line-height: 1.5;
    color: #ecf0f1;
    white-space: pre-wrap; /* ä¿ç•™æ›è¡Œæ ¼å¼ */
}

/* åº•éƒ¨æç¤ºå­— */
.flip-hint {
    flex: 0 0 auto;
    margin-top: 10px;
    font-size: 0.8em;
    color: #95a5a6;
    opacity: 0.8;
}

/* å·¥ä½œå®¤ Logo å®¹å™¨ */
.studio-logo-container {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1); /* ä¸Šæ–¹åˆ†éš”ç·š */
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%; /* ç¢ºä¿å®¹å™¨å¯¬åº¦æ­£ç¢º */
}

/* Logo åœ–ç‰‡æ¨£å¼ */
#studio-logo {
    /* ğŸ”¥ é—œéµä¿®æ­£ï¼šé™åˆ¶æœ€å¤§å¯¬åº¦ */
    width: 100%;        /* è®“åœ–ç‰‡å…·æœ‰éŸ¿æ‡‰å¼ç‰¹æ€§ */
    max-width: 360px;   /* å¼·åˆ¶é™åˆ¶æœ€å¤§å¯¬åº¦ç‚º 120px (è§£æ±ºé›»è…¦ç‰ˆéå¤§å•é¡Œ) */
    height: auto;       /* ä¿æŒåŸå§‹é•·å¯¬æ¯”ï¼Œåœ–ç‰‡æ‰ä¸æœƒè®Šå½¢ */
    
    display: block;
    opacity: 0.9;       /* ç¨å¾®é€æ˜å¢åŠ è³ªæ„Ÿ */
    transition: transform 0.3s ease;
    margin-bottom: 5px; /* è®“åœ–ç‰‡è·Ÿä¸‹æ–¹çš„æ–‡å­—æœ‰ä¸€é»è·é›¢ */
}

/* æ»‘é¼ ç§»éå»æ™‚çš„ç‰¹æ•ˆ */
#studio-logo:hover {
    transform: scale(1.05);
    opacity: 1;
}
/* =========================================
   ğŸ”¥ åœ–é‘‘ç³»çµ±å°ˆç”¨æ¨£å¼ (è«‹åŠ åœ¨ style.css æœ€ä¸‹æ–¹)
   ========================================= */

/* 1. åœ–é‘‘å®¹å™¨ä½ˆå±€ (é—œéµä¿®æ­£ï¼šè®“å®ƒèƒ½æ»‘å‹•ä¸”ä¸è¶…å‡ºè¦–çª—) */
#gallery-grid {
    flex: 1;                     /* è‡ªå‹•å¡«æ»¿ Modal å‰©é¤˜ç©ºé–“ */
    overflow-y: auto;            /* å…§å®¹è¶…å‡ºæ™‚é¡¯ç¤ºå‚ç›´æ²è»¸ */
    align-content: flex-start;   /* å¡ç‰‡å¾ä¸Šæ–¹é–‹å§‹æ’åˆ—ï¼Œä¸è¦åˆ†æ•£å°é½Š */
    min-height: 0;               /* é˜²æ­¢ Flex å­å…ƒç´ æº¢å‡ºå®¹å™¨ */
    padding: 10px;               /* å…§è· */
    
    /* ç¹¼æ‰¿ card-container çš„æ’ç‰ˆç‰¹æ€§ */
    display: flex;         
    flex-wrap: wrap;       
    justify-content: flex-start; /* é å·¦å°é½Š */
    gap: 15px;                   /* å¡ç‰‡é–“è· */
}

/* 2. æœªç²å¾—çš„å¡ç‰‡æ¨£å¼ï¼šç°éš + é–é ­ */
.card.locked {
    filter: grayscale(100%);     /* é»‘ç™½æ¿¾é¡ */
    opacity: 0.6;                /* åŠé€æ˜ */
    cursor: not-allowed;         /* ç¦æ­¢æ‰‹å‹¢ */
    position: relative;
    border-color: #555 !important; /* å¼·åˆ¶ç°è‰²é‚Šæ¡† */
    box-shadow: none !important;   /* ç§»é™¤ç™¼å…‰ç‰¹æ•ˆ */
    animation: none !important;    /* ç§»é™¤ SSR è·³å‹•ç‰¹æ•ˆ */
}

/* é–é ­åœ–ç¤º (è¦†è“‹åœ¨å¡ç‰‡ä¸Š) */
.card.locked::after {
    content: "ğŸ”’";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3em;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 0 0 5px #000;
    pointer-events: none;
    z-index: 10;
}

/* 3. åœ–é‘‘éæ¿¾æŒ‰éˆ• (ç¨ç«‹æ¨£å¼ï¼Œé¿å…è·ŸèƒŒåŒ…è¡çª) */
.gallery-filter-btn {
    background: transparent;
    border: 2px solid #ddd;
    color: #ddd;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
    margin: 0 2px;
}

.gallery-filter-btn:hover {
    background: rgba(255,255,255,0.1);
}

.gallery-filter-btn.active {
    background: #fff;
    color: #2c3e50 !important;
    border-color: #fff !important;
}

/* =========================================
   ğŸ”¥ é­”ç‹ AOE ç‰¹æ•ˆ (æ–°å¢)
   ========================================= */

/* é€šç”¨å®¹å™¨ä½ç½®è¨­å®š */
.vfx-boss-shockwave, .vfx-boss-explosion, .vfx-boss-storm, .vfx-boss-slash-spin {
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 500;
}

/* 1. éœ‡æ³¢ (Shockwave) */
.vfx-boss-shockwave {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 5px solid transparent; /* é¡è‰²ç”± JS å‹•æ…‹æ§åˆ¶ */
    opacity: 0.8;
    animation: bossShockwaveAnim 0.8s ease-out forwards;
}

@keyframes bossShockwaveAnim {
    0% { width: 20px; height: 20px; opacity: 1; border-width: 5px; }
    100% { width: 300px; height: 300px; opacity: 0; border-width: 0px; }
}

/* 2. çˆ†ç‚¸ (Explosion) */
.vfx-boss-explosion {
    width: 200px; height: 200px;
    background: radial-gradient(circle, #fff 0%, transparent 70%); /* JS æœƒè¦†è“‹é¡è‰² */
    border-radius: 50%;
    filter: blur(2px);
    animation: bossExplosionAnim 0.6s ease-out forwards;
}

@keyframes bossExplosionAnim {
    0% { transform: translate(-50%, -50%) scale(0.1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* 3. é¢¨æš´ (Storm) */
.vfx-boss-storm {
    width: 250px; height: 250px;
    border-radius: 50%;
    border: 2px dashed #fff; /* JS æœƒè¦†è“‹é¡è‰² */
    animation: bossStormAnim 1s linear forwards;
}

@keyframes bossStormAnim {
    0% { transform: translate(-50%, -50%) rotate(0deg) scale(0.5); opacity: 0; }
    20% { opacity: 1; }
    100% { transform: translate(-50%, -50%) rotate(360deg) scale(1.2); opacity: 0; }
}

/* 4. æ—‹é¢¨æ–¬ (Slash Spin) */
.vfx-boss-slash-spin {
    width: 200px; height: 200px;
    border: 4px solid transparent;
    border-top-color: inherit; /* åƒ JS è¨­å®šçš„é¡è‰² */
    border-bottom-color: inherit;
    border-radius: 50%;
    animation: bossSpinAnim 0.5s ease-out forwards;
}

@keyframes bossSpinAnim {
    0% { transform: translate(-50%, -50%) rotate(0deg) scale(0.1); opacity: 1; }
    100% { transform: translate(-50%, -50%) rotate(720deg) scale(1.5); opacity: 0; }
}

/* é—œå¡èˆ‡é›£åº¦æŒ‰éˆ•çš„é–å®šç‹€æ…‹ */
.level-btn.locked,
.difficulty-btn.locked {
    opacity: 0.5;
    filter: grayscale(100%);
    cursor: not-allowed !important;
    position: relative;
    pointer-events: none; /* ç¦æ­¢é»æ“Š */
}

/* é–é ­åœ–ç¤º (è¦†è“‹åœ¨æŒ‰éˆ•ä¸Š) */
.level-btn.locked::after,
.difficulty-btn.locked::after {
    content: "ğŸ”’";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    text-shadow: 0 0 5px black;
    z-index: 10;
}

.difficulty-btn.locked::after {
    font-size: 1.2em; /* é›£åº¦æŒ‰éˆ•è¼ƒå°ï¼Œé–é ­ç¸®å° */
}

/* é€šçŸ¥ç´…é» */
#notification-btn {
    position: relative; /* è®“ç´…é»å¯ä»¥çµ•å°å®šä½ */
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.75em;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 2px solid #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    z-index: 10;
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.notification-badge.hidden {
    display: none;
}

/* é¨å…µå°ˆå±¬ï¼šç¶ è‰²åº•è‰² */
.hero-type-badge.cavalry {
    background-color: #27ae60; /* ç¿¡ç¿ ç¶  */
    box-shadow: 0 0 5px #2ecc71;
}

/* ç¢ºä¿æ‰€æœ‰æˆ°é¬¥å–®ä½é è¨­å‚ç›´ç½®ä¸­ä¸”é¢å‘å³ */
.hero-unit, .enemy-unit {
    transform: translateY(-50%) scaleX(1);
    transform-origin: center center; /* ç¢ºä¿ç¿»è½‰æ™‚ä»¥ä¸­å¿ƒç‚ºè»¸ */
    transition: transform 0.1s linear; /* å¢åŠ ä¸€é»è½‰å‘çš„å¹³æ»‘æ„Ÿ */
}

/* ç•¶å–®ä½éœ€è¦é¢å‘å·¦æ™‚ï¼Œå¥—ç”¨æ­¤ class */
.unit-flipped {
    transform: translateY(-50%) scaleX(-1) !important;
}

/* ğŸ”¥ é—œéµä¿®æ­£ï¼šç•¶çˆ¶å±¤è¢«ç¿»è½‰æ™‚ï¼ŒæŠŠå…§éƒ¨çš„è¡€æ¢ã€æ°£åŠ›æ¢ã€å…µç¨®åœ–ç¤ºã€Œç¿»å›ä¾†ã€(è² è² å¾—æ­£) */
/* ä¿®æ­£é‡é»ï¼š
   1. transform: translateX(-50%) -> ç¶­æŒç½®ä¸­
   2. scaleX(-1) -> æŠµéŠ·çˆ¶å±¤é¡åƒï¼Œç¢ºä¿è¡€æ¢æ–¹å‘æ­£ç¢º
*/
.unit-flipped .hero-hp-bar,
.unit-flipped .enemy-hp-bar,
.unit-flipped .hero-mana-bar {
    transform: translateX(-50%) scaleX(-1) !important;
}

/* å…µç¨®åœ–ç¤ºä¸éœ€è¦ç½®ä¸­ä¿®æ­£ (å› ç‚ºå®ƒæ˜¯å®šä½åœ¨è§’è½çš„)ï¼Œåªéœ€æŠµéŠ·ç¿»è½‰ */
.unit-flipped .hero-type-badge {
    transform: scaleX(-1);
}

/* =========================================
   ğŸ° é ˜åœ°ç³»çµ±æ¨£å¼ (æ–°å¢)
   ========================================= */

.territory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    padding: 10px;
}

.building-card {
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid #7f8c8d;
    border-radius: 10px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
    transition: transform 0.2s;
}

.building-card:hover {
    border-color: #27ae60;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
}

.building-card.castle { border-color: #f1c40f; }
.building-card.farm { border-color: #f39c12; }
.building-card.mine { border-color: #95a5a6; }
.building-card.warehouse { border-color: #3498db; }

.build-info {
    flex: 1;
}

.build-name {
    font-size: 1.2em;
    font-weight: bold;
    color: #ecf0f1;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.build-lv {
    font-size: 0.8em;
    background: #27ae60;
    padding: 2px 6px;
    border-radius: 4px;
}

.build-desc {
    font-size: 0.85em;
    color: #bdc3c7;
    margin: 5px 0 10px 0;
    min-height: 2.5em; /* ä¿æŒé«˜åº¦ä¸€è‡´ */
}

.build-stat {
    background: rgba(255, 255, 255, 0.1);
    padding: 5px;
    border-radius: 4px;
    font-size: 0.9em;
    color: #f1c40f;
    margin-bottom: 10px;
}

.build-actions {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: auto;
}

.btn-upgrade-build {
    background: #e67e22;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9em;
    transition: 0.2s;
}

.btn-upgrade-build:hover {
    background: #d35400;
}

.claim-btn {
    background: #27ae60;
    width: 100%;
    margin: 0 0 5px 0;
    padding: 8px;
    font-size: 0.9em;
}

.claim-btn.disabled {
    background: #7f8c8d;
    opacity: 0.6;
    pointer-events: none;
}

/* å»ºé€ é€²åº¦æ¢ */
.build-progress-bar {
    height: 6px;
    background: #333;
    border-radius: 3px;
    margin-top: 10px;
    overflow: hidden;
    position: relative;
}

.build-progress-bar .fill {
    height: 100%;
    background: #3498db;
    animation: progressStripes 1s linear infinite;
    background-image: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.15) 25%,
        transparent 25%,
        transparent 50%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0.15) 75%,
        transparent 75%,
        transparent
    );
    background-size: 20px 20px;
}

.timer-text {
    position: absolute;
    top: -20px;
    right: 0;
    font-size: 0.8em;
    color: #3498db;
    font-weight: bold;
}

@keyframes progressStripes {
    from { background-position: 20px 0; }
    to { background-position: 0 0; }
}

/* style.css æ–°å¢éƒ¨åˆ† - å†’éšªæ¨¡å¼ */

#adventure-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100dvh; /* ğŸ”¥ æ”¹ç‚º 100dvh (Dynamic Viewport Height)ï¼Œè‡ªå‹•æ‰£é™¤ç€è¦½å™¨å·¥å…·åˆ—é«˜åº¦ */
    background-color: #000;
    z-index: 3000; /* æ¯”ä¸€èˆ¬æˆ°é¬¥ç•«é¢æ›´é«˜ */
    overflow: hidden;
    /* ğŸ”¥ é—œéµï¼šç¦æ­¢ç€è¦½å™¨é è¨­çš„è§¸æ§è¡Œç‚º (å¦‚é›™æ“Šç¸®æ”¾ã€æ»‘å‹•ç¿»é ) */
    touch-action: none; 
    /* ğŸ”¥ é—œéµï¼šç¦æ­¢ iOS Safari çš„æ©¡çš®ç­‹è¿´å½ˆæ•ˆæœ */
    overscroll-behavior: none; 
}

#adv-canvas {
    display: block;
    width: 100%;
    height: 100%;
    background-color: #333; /* æš«æ™‚èƒŒæ™¯è‰² */
}

#adv-ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ° Canvas (é™¤éé»åˆ°æŒ‰éˆ•) */
    padding: 20px;
    box-sizing: border-box;
}

.adv-top-bar {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.adv-player-info {
    display: flex;
    gap: 10px;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px;
    border-radius: 10px;
    pointer-events: auto;
}

.adv-avatar {
    width: 50px;
    height: 50px;
    background: #555;
    border-radius: 50%;
    border: 2px solid #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5em;
}

.adv-bars {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    width: 150px;
}

.adv-hp-bar, .adv-mp-bar {
    width: 100%;
    height: 10px;
    background: #333;
    border-radius: 5px;
    border: 1px solid #fff;
    overflow: hidden;
}

.adv-hp-bar div { background: #e74c3c; height: 100%; }
.adv-mp-bar div { background: #3498db; height: 100%; }

#adv-exit-btn {
    pointer-events: auto; /* è®“æŒ‰éˆ•å¯é»æ“Š */
}

.adv-controls-hint {
    position: absolute;
    /* bottom: 20px; ç§»é™¤èˆŠçš„ */
    top: 80px; /* ğŸ”¥ æ”¹åˆ°å·¦ä¸Šè§’ (è¡€æ¢ä¸‹æ–¹) */
    left: 20px;
    color: rgba(255, 255, 255, 0.7);
    font-family: monospace;
    background: rgba(0,0,0,0.5);
    padding: 10px;
    border-radius: 5px;
    pointer-events: none; /* é˜²æ­¢é®æ“‹æ“ä½œ */
}

/* style.css æ–°å¢æŠ€èƒ½åˆ—æ¨£å¼ */

#adv-skill-bar-container {
    position: absolute;
    bottom: calc(20px + env(safe-area-inset-bottom)); /* ğŸ”¥ è‡ªå‹•åŠ ä¸Šå®‰å…¨å€åŸŸè·é›¢ */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    background: rgba(0, 0, 0, 0.6);
    padding: 8px 15px; /* ğŸ”¥ å¢åŠ  padding */
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    pointer-events: auto; /* è®“æŒ‰éˆ•å¯é»æ“Š */
    z-index: 9000; /* ğŸ”¥ ç¢ºä¿åœ¨æ–æ¡¿ä¹‹ä¸‹æˆ–ä¸å¹²æ“¾ */
}

.adv-skill-slot {
    width: 60px;
    height: 60px;
    position: relative;
    border: 2px solid #aaa;
    border-radius: 8px;
    background: #222;
    cursor: pointer;
    overflow: hidden;
    transition: transform 0.1s;
}

.adv-skill-slot:active {
    transform: scale(0.95);
}

.adv-skill-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* å†·å»é®ç½© */
.adv-skill-cooldown {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%; /* é«˜åº¦æœƒç”± JS æ§åˆ¶è®ŠåŒ– */
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    font-size: 1.2em;
    transition: height 0.1s linear;
}

.adv-skill-slot.ready {
    border-color: #f1c40f;
    box-shadow: 0 0 10px #f1c40f;
}

/* style.css - è™›æ“¬æ–æ¡¿æ¨£å¼ (ä¿®æ­£ç‰ˆ) */

#virtual-joystick-zone {
    position: absolute;
    bottom: calc(120px + env(safe-area-inset-bottom)); /* ğŸ”¥ è‡ªå‹•åŠ ä¸Šå®‰å…¨å€åŸŸè·é›¢ */
    left: 40px;    /* ğŸ”¥ ç¨å¾®èª¿æ•´ */
    width: 120px;
    height: 120px;
    z-index: 9999; /* ğŸ”¥ åŠ é«˜å±¤ç´šï¼Œç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
    touch-action: none; 
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: auto; /* ğŸ”¥ é—œéµï¼é€™è¡Œè®“æ–æ¡¿å¯ä»¥è¢«è§¸æ‘¸ï¼Œä¸å—çˆ¶å±¤å½±éŸ¿ */
}

#joystick-base {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.15); /* ç¨å¾®äº®ä¸€é» */
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    position: relative;
    backdrop-filter: blur(4px);
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

#joystick-stick {
    width: 50px;
    height: 50px;
    background: radial-gradient(circleAt 30% 30%, #f1c40f, #f39c12); /* æ¼¸å±¤è³ªæ„Ÿ */
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    pointer-events: none;
}

/* --- ä¿®æ­£å¾Œçš„æ•´è£ä»‹é¢æ¨£å¼ (è«‹è¦†è“‹ style.css åŸæœ¬å¾ŒåŠæ®µé—œæ–¼ prep çš„éƒ¨åˆ†) --- */

/* === 7. å†’éšªæ¨¡å¼ï¼šæ•´è£å¤§å»³ (Prep Screen) === */

/* ä½ˆå±€å®¹å™¨ */
.prep-container {
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    padding: 10px;
    display: flex; /* ğŸ”¥ é—œéµä¿®æ­£ï¼šPC ç‰ˆè¦æ©«å‘æ’åˆ— */
    gap: 15px;
    flex: 1;          
    min-height: 0;    
    overflow: hidden; 
}

/* å·¦å´ï¼šè‹±é›„é¢æ¿ */
.prep-hero-panel {
    flex: 0 0 320px; /* å›ºå®šå¯¬åº¦ */
    background: #34495e;
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto; 
}

.prep-hero-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
    border: 1px solid transparent;
}
.prep-hero-preview:hover { 
    background: rgba(255,255,255,0.1); 
    border-color: rgba(255,255,255,0.3);
}

.prep-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 5px;
    width: 100%;
    font-size: 0.85em;
    text-align: left;
    margin-top: 5px;
    box-sizing: border-box;
}

/* å·¦å´è£å‚™ç¶²æ ¼ (2x3) */
.prep-equip-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 10px;
}

.prep-equip-grid .equip-slot {
    background: #222;
    border: 2px solid #555;
    border-radius: 5px;
    width: 100%;
    aspect-ratio: 1 / 1; /* å¼·åˆ¶æ­£æ–¹å½¢ */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    position: relative;
    font-size: 1.5em;
    transition: 0.2s;
}
.prep-equip-grid .equip-slot:hover, 
.prep-equip-grid .equip-slot.selected { 
    border-color: #f1c40f !important; 
    box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); 
    background: rgba(241, 196, 15, 0.1);
}
.prep-equip-grid .equip-slot .slot-label {
    font-size: 0.8rem; color: #aaa; margin-top: 2px;
}

/* ç‰©å“æ§½ */
.prep-card-slots, .prep-item-slots {
    display: flex;
    gap: 5px;
    justify-content: center;
    flex-wrap: wrap;
}
.item-slot {
    width: 40px; height: 40px;
    border: 1px dashed #777;
    background: rgba(0,0,0,0.2);
    display: flex; justify-content: center; align-items: center;
    border-radius: 4px;
    font-size: 0.8em; color: #555;
}

/* å³å´ï¼šå‹•ä½œé¢æ¿ */
.prep-action-panel {
    flex: 1; 
    background: #2c3e50;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    border: 1px solid #555;
    min-width: 0; 
    overflow: hidden;
}

.prep-tabs { display: flex; border-bottom: 1px solid #555; background: #222; flex-shrink: 0; }
.prep-tab-btn { flex: 1; background: transparent; border: none; padding: 12px; color: #aaa; cursor: pointer; font-weight: bold; border-right: 1px solid #444; }
.prep-tab-btn.active { background: #e67e22; color: white; }

.prep-tab-content { 
    display: none; 
    flex: 1; 
    padding: 10px; 
    overflow-y: auto; 
}
.prep-tab-content.active { display: block; }

/* å³å´è£å‚™åˆ—è¡¨ (Grid ä½ˆå±€) */
.prep-grid-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 10px;
    align-content: start;
}

.prep-grid-list .equip-slot {
    background: #222;
    border: 2px solid #555;
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    cursor: pointer;
    padding: 5px;
    box-sizing: border-box;
    height: 120px;
    width: 100%;
}

.prep-grid-list .equip-slot img {
    width: 50px; height: 50px; margin-bottom: 5px; object-fit: contain;
}

.slot-label { font-size: 0.8em; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: bold; }
.slot-stats { font-size: 0.7em; color: #ccc; margin-top: 2px; line-height: 1.2; text-align: center; white-space: pre-wrap; width: 100%; }

/* å•†åº—èˆ‡é—œå¡ */
.shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
.shop-item { background: rgba(255,255,255,0.05); border: 1px solid #555; padding: 10px; border-radius: 5px; text-align: center; }
.level-select-grid { display: flex; flex-direction: column; gap: 8px; }
.prep-level-btn { background: #34495e; color: white; border: 2px solid #777; padding: 15px; border-radius: 8px; cursor: pointer; text-align: left; }
.prep-level-btn.selected { border-color: #f1c40f; background: rgba(241, 196, 15, 0.1); }
.prep-level-btn.locked { opacity: 0.5; pointer-events: none; filter: grayscale(1); }

/* === 8. å†’éšªæ¨¡å¼ï¼šæˆ°é¬¥ç•«é¢ === */
#adventure-screen {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100dvh;
    background-color: #000; z-index: 3000; overflow: hidden;
    touch-action: none; overscroll-behavior: none;
}
#adv-canvas { display: block; width: 100%; height: 100%; background-color: #333; }
#adv-ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; padding: 20px; box-sizing: border-box; }
.adv-top-bar { display: flex; justify-content: space-between; align-items: flex-start; }
.adv-player-info { display: flex; gap: 10px; background: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 10px; pointer-events: auto; }
.adv-avatar { width: 50px; height: 50px; background: #555; border-radius: 50%; border: 2px solid #fff; display: flex; justify-content: center; align-items: center; font-size: 1.5em; }
.adv-bars { display: flex; flex-direction: column; justify-content: center; gap: 5px; width: 150px; }
.adv-hp-bar, .adv-mp-bar { width: 100%; height: 10px; background: #333; border-radius: 5px; border: 1px solid #fff; overflow: hidden; }
.adv-hp-bar div { background: #e74c3c; height: 100%; }
.adv-mp-bar div { background: #3498db; height: 100%; }
#adv-exit-btn { pointer-events: auto; }
.adv-controls-hint { position: absolute; top: 80px; left: 20px; color: rgba(255, 255, 255, 0.7); font-family: monospace; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; pointer-events: none; }
#adv-skill-bar-container { position: absolute; bottom: calc(20px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0, 0, 0, 0.6); padding: 8px 15px; border-radius: 15px; border: 1px solid #aaa; pointer-events: auto; z-index: 9000; }
.adv-skill-slot { width: 60px; height: 60px; position: relative; border: 2px solid #aaa; border-radius: 8px; background: #222; cursor: pointer; overflow: hidden; transition: transform 0.1s; }
.adv-skill-slot:active { transform: scale(0.95); }
.adv-skill-img { width: 100%; height: 100%; object-fit: cover; }
.adv-skill-cooldown { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 1.2em; transition: height 0.1s linear; }
.adv-skill-slot.ready { border-color: #f1c40f; box-shadow: 0 0 10px #f1c40f; }
#virtual-joystick-zone { position: absolute; bottom: calc(120px + env(safe-area-inset-bottom)); left: 40px; width: 120px; height: 120px; z-index: 9999; touch-action: none; user-select: none; display: flex; justify-content: center; align-items: center; pointer-events: auto; }
#joystick-base { width: 100%; height: 100%; background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.5); border-radius: 50%; position: relative; backdrop-filter: blur(4px); box-shadow: 0 0 15px rgba(0,0,0,0.5); }
#joystick-stick { width: 50px; height: 50px; background: radial-gradient(circleAt 30% 30%, #f1c40f, #f39c12); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 4px 6px rgba(0,0,0,0.4); pointer-events: none; }

.hidden { display: none !important; }
@keyframes goldPulse { from { box-shadow: 0 0 10px rgba(241, 196, 15, 0.5); } to { box-shadow: 0 0 25px rgba(241, 196, 15, 1); } }

/* === 9. ğŸ”¥ æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­å®š (æ”¾åœ¨æœ€å¾Œé¢ï¼Œç¢ºä¿æ¬Šé‡æœ€é«˜) === */
@media (max-width: 768px) {
    .card { width: 100px; height: 150px; }
    .status-bar { font-size: 0.9em; }

    /* æ•´è£ä»‹é¢æ‰‹æ©Ÿç‰ˆï¼šå¼·åˆ¶å‚ç›´æ’åˆ— */
    .prep-container {
        flex-direction: column; /* ä¸Šä¸‹æ’åˆ— */
        height: auto;
        max-height: 80vh; 
        overflow-y: auto;
        gap: 10px;
    }
    
    .prep-hero-panel { 
        flex: none; 
        width: 100%; 
        overflow: visible; 
    }
    
    .prep-action-panel { 
        flex: 1; 
        width: 100%; 
        min-height: 400px; /* ç¢ºä¿åˆ—è¡¨æœ‰ç©ºé–“ */
    }
    
    .prep-equip-grid { gap: 5px; }
    
    #adv-skill-bar-container { bottom: calc(10px + env(safe-area-inset-bottom)); transform: translateX(-50%) scale(0.85); padding: 5px; gap: 5px; }
    .adv-skill-slot { width: 50px; height: 50px; }
    #virtual-joystick-zone { bottom: calc(150px + env(safe-area-inset-bottom)); left: 30px; }
}