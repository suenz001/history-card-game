<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歷史英靈：策略對決</title>
    <link rel="stylesheet" href="style.css?v=120">
</head>
<body>

    <audio id="bgm" loop><source src="assets/sounds/bgm.mp3" type="audio/mpeg"></audio>
    <audio id="bgm-battle" loop><source src="assets/sounds/bgm-battle.mp3" type="audio/mpeg"></audio>
    
    <audio id="sfx-draw"><source src="assets/sounds/draw.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-ssr"><source src="assets/sounds/ssr.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-reveal"><source src="assets/sounds/reveal.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-coin"><source src="assets/sounds/coin.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-upgrade"><source src="assets/sounds/upgrade.mp3" type="audio/mpeg"></audio>
    
    <div class="game-container">
        <h1>⚔️ 歷史英靈：策略對決</h1>

        <div id="login-section">
            <h3>請先登入</h3>
            <div style="margin-bottom: 15px;">
                <input type="text" id="email-input" placeholder="Email">
                <input type="password" id="pass-input" placeholder="密碼">
            </div>
            <button id="email-login-btn" class="btn-primary">登入</button>
            <button id="email-signup-btn" class="btn-secondary">註冊</button>
            <hr>
            <button id="guest-btn" class="btn-secondary" style="width: 100%;">👤 遊客試玩</button>
        </div>

        <div id="user-info" style="display:none;">
            <div class="user-status">
                <span id="user-name">玩家：...</span>
                <span id="power-display">🔥 戰力: 0</span>
            </div>
            <div class="resources">
                <span>💎 <span id="gem-count">0</span></span>
                <span>💰 <span id="gold-count">0</span></span>
            </div>
            <div class="user-actions">
                <button id="settings-btn" class="icon-btn">⚙️ 設定</button>
                <button id="notification-btn" class="icon-btn">🔔 通知</button>
                <button id="logout-btn" class="btn-danger-small">登出</button>
            </div>
        </div>

        <div id="game-ui" class="hidden">
            
            <div class="lobby-container">
                <div class="gacha-section">
                    <button id="draw-btn" class="btn-gacha">
                        <span class="gacha-title">單次召喚</span>
                        <span class="gacha-cost">💎 100</span>
                    </button>
                    <button id="draw-10-btn" class="btn-gacha gacha-10">
                        <span class="gacha-title">十連召喚</span>
                        <span class="gacha-cost">💎 1000</span>
                        <span class="gacha-tag">必出 SR+</span>
                    </button>
                </div>

                <div class="menu-grid">
                    <button id="inventory-btn" class="btn-menu">🎒 我的背包 / 編隊</button>
                    <button id="pvp-menu-btn" class="btn-menu pvp-btn">🏟️ PVP 競技場</button>
                    <button id="enter-battle-mode-btn" class="btn-menu battle-mode-btn">⚔️ 進入 PVE 戰場</button>
                </div>

                <div class="leaderboard-panel">
                    <h3>🏆 戰力排行榜</h3>
                    <div id="leaderboard-list">
                        <div class="rank-item">載入中...</div>
                    </div>
                </div>
            </div>

            <div id="battle-screen" class="hidden">
                <div class="battle-monitor-sidebar">
                    <button id="toggle-sidebar-btn">▶</button>
                    
                    <h3 style="font-size: 0.9em; margin: 10px 0 5px; color: #3498db; border-bottom: 2px solid #3498db; padding-bottom: 3px;">我方狀態</h3>
                    <div id="hero-monitor-list" style="max-height: 45%; overflow-y: auto;"></div>
                    
                    <h3 style="font-size: 0.9em; margin: 15px 0 5px; color: #e74c3c; border-bottom: 2px solid #e74c3c; padding-bottom: 3px;">敵方狀態</h3>
                    <div id="enemy-monitor-list" style="max-height: 45%; overflow-y: auto;"></div>
                </div>

                <div class="battle-field-container">
                    <div id="wave-notification" class="hidden">第 1 波 來襲!</div>
                    
                    <div class="lanes-wrapper">
                        <div class="battle-lane"></div>
                        <div class="battle-lane"></div>
                        <div class="battle-lane"></div>
                    </div>

                    <div id="enemy-container"></div>
                    <div id="hero-container"></div>
                </div>

                <div id="battle-ui-layer">
                    <div class="battle-stats">
                        <span>💰 本場金幣: <span id="battle-gold">0</span></span>
                        <span>🌊 波次: <span id="wave-count">1</span></span>
                        <span>🛡️ 存活: <span id="hero-count-display">0</span></span>
                    </div>
                    
                    <div class="battle-controls">
                        <button id="speed-btn" class="btn-secondary-small">⏩ 1x</button>
                        <button id="retreat-btn" class="btn-danger-small">🏳️ 撤退</button>
                    </div>

                    <div class="deploy-controls">
                        <div class="defense-grid-mini">
                            <div class="defense-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                            <div class="defense-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                        </div>
                        <div style="display:flex; flex-direction:column; gap:5px;">
                            <button id="auto-deploy-btn" class="btn-primary-small">⚡ 自動佈署</button>
                            <button id="clear-deploy-btn" class="btn-secondary-small">🗑️ 清空</button>
                            <button id="start-battle-btn" class="btn-success-small btn-disabled">請先部署英雄</button>
                        </div>
                    </div>
                </div>

                <div id="difficulty-controls">
                    <button class="difficulty-btn" data-diff="easy" style="background:#2ecc71;">簡單 (50%金幣)</button>
                    <button class="difficulty-btn active" data-diff="normal" style="background:#f1c40f;">普通 (100%金幣)</button>
                    <button class="difficulty-btn" data-diff="hard" style="background:#e74c3c;">困難 (200%金幣)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="gacha-overlay" class="hidden">
        <div id="summon-circle"></div>
        <div id="summon-burst"></div>
        <div id="summon-text">召喚中...</div>
        <button id="gacha-skip-btn">⏩ 跳過動畫</button>
    </div>

    <div id="gacha-reveal-modal" class="modal hidden">
        <div class="modal-content transparent-bg">
            <div id="gacha-reveal-container"></div>
            <div class="click-hint">點擊螢幕繼續...</div>
        </div>
    </div>

    <div id="inventory-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="inventory-title">🎒 我的背包</h2>
                <button id="close-inventory-btn" class="btn-close">×</button>
            </div>
            
            <div class="inventory-controls">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="ALL">全部</button>
                    <button class="filter-btn" data-filter="SSR" style="color:#f1c40f">SSR</button>
                    <button class="filter-btn" data-filter="SR" style="color:#9b59b6">SR</button>
                    <button class="filter-btn" data-filter="R" style="color:#3498db">R</button>
                </div>
                <select id="sort-select">
                    <option value="time_desc">獲得時間 (新→舊)</option>
                    <option value="rarity_desc">稀有度 (高→低)</option>
                    <option value="power_desc">戰力 (高→低)</option>
                    <option value="id_asc">編號 (小→大)</option>
                </select>
            </div>

            <div class="batch-controls">
                <button id="batch-toggle-btn" class="btn-secondary-small">🔧 批量分解</button>
                <div id="batch-action-bar" class="hidden">
                    <span id="batch-info">已選 0 張</span>
                    <button id="batch-confirm-btn" class="btn-danger-small btn-disabled">確認分解</button>
                </div>
            </div>

            <div class="function-bar">
                <button id="auto-star-btn" class="btn-upgrade" style="flex:1;">⚡ 一鍵升星</button>
                <button id="inventory-clear-btn" class="btn-secondary" style="flex:0.5;">🗑️ 清空佈署</button>
            </div>

            <div id="inventory-grid" class="card-grid"></div>
        </div>
    </div>

    <div id="detail-modal" class="modal hidden" style="z-index: 99999;">
        <div class="modal-content card-detail-content">
            <button id="close-detail-btn" class="btn-close-circle">×</button>
            
            <div class="detail-layout">
                <button id="prev-card-btn" class="nav-btn">❮</button>
                <div id="large-card-view"></div>
                <button id="next-card-btn" class="nav-btn">❯</button>
            </div>

            <div class="upgrade-controls">
                <button id="upgrade-level-btn" class="btn-upgrade">⬆️ 升級</button>
                <button id="upgrade-star-btn" class="btn-upgrade star-up">⭐ 升星</button>
            </div>
            <button id="dismantle-btn" class="btn-danger" style="margin-top:10px; width:100%;">♻️ 分解卡片</button>
        </div>
    </div>

    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h2>⚙️ 設定</h2>
            
            <div class="setting-item">
                <span>你的暱稱</span>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="settings-name-input" placeholder="輸入新暱稱">
                    <button id="settings-save-name-btn" class="btn-primary-small">保存</button>
                </div>
            </div>

            <div class="setting-item">
                <span>🎵 背景音樂</span>
                <input type="checkbox" id="bgm-toggle" checked>
            </div>
            <div class="setting-item">
                <span>🔊 音量</span>
                <input type="range" id="bgm-volume" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="setting-item">
                <span>⚔️ 音效</span>
                <input type="checkbox" id="sfx-toggle" checked>
            </div>
            <div class="setting-item">
                <span>🔊 音效音量</span>
                <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="1.0">
            </div>

            <hr>
            <h3>🎁 禮包碼兌換</h3>
            <div style="display:flex; gap:5px;">
                <input type="text" id="redeem-code-input" placeholder="輸入序號">
                <button id="redeem-btn" class="btn-success-small">兌換</button>
            </div>

            <button id="close-settings-btn" class="btn-secondary" style="margin-top:20px; width:100%;">關閉</button>
        </div>
    </div>

    <div id="notification-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔔 戰報與公告</h2>
                <button id="close-notification-btn" class="btn-close">×</button>
            </div>
            <div id="notification-list">
                </div>
        </div>
    </div>

    <div id="battle-result-modal" class="modal hidden">
        <div class="modal-content result-content">
            <h1 id="result-title">VICTORY</h1>
            <div class="rewards">
                <div id="result-gold" class="reward-item">💰 +0</div>
                <div id="result-gems" class="reward-item">💎 +0</div>
            </div>
            
            <div class="dps-panel">
                <h3>📊 戰鬥數據</h3>
                <div id="dps-chart"></div>
            </div>

            <button id="close-result-btn" class="btn-primary" style="margin-top:20px; width:80%;">確定</button>
        </div>
    </div>

    <div id="pvp-setup-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>🛡️ 設定防守陣容</h2>
                <button id="close-pvp-modal-btn" class="btn-close">×</button>
            </div>
            <p style="text-align:center; color:#ccc; font-size:0.9em;">其他玩家將會挑戰此陣容，請配置最強防守！</p>
            
            <div class="lanes-wrapper" style="margin: 20px 0; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                <div class="defense-grid">
                    <div class="lane-row">
                        <div class="defense-slot pvp-defense-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                    </div>
                    <div class="lane-row">
                        <div class="defense-slot pvp-defense-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                    </div>
                    <div class="lane-row">
                        <div class="defense-slot pvp-defense-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot pvp-defense-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button id="pvp-search-btn" class="btn-danger" style="flex: 1;">🔍 尋找對手</button>
                <button id="save-pvp-team-btn" class="btn-success" style="flex: 1;">💾 儲存防守陣容</button>
            </div>
        </div>
    </div>

    <div id="pvp-arena-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>🏟️ 競技場</h2>
                <button id="close-arena-btn" class="btn-close">×</button>
            </div>

            <div id="pvp-loading" class="hidden" style="text-align:center; padding: 50px;">
                <div class="spinner"></div>
                <p>正在搜尋對手...</p>
            </div>

            <div id="pvp-opponent-list-view">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <span>選擇你的對手 (消耗 0 體力)</span>
                    <button id="refresh-opponent-btn" class="btn-secondary-small">🔄 刷新</button>
                </div>
                <div id="pvp-opponent-list"></div>
            </div>

            <div id="pvp-match-content" class="hidden">
                <div class="matchup-banner">
                    <div class="fighter my-side">
                        <div class="avatar my-avatar">我</div>
                        <div class="name" id="arena-my-name">玩家名稱</div>
                        <div class="power" id="arena-my-power">戰力: 0</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="fighter enemy-side">
                        <div class="avatar enemy-avatar">敵</div>
                        <div class="name" id="arena-enemy-name">對手名稱</div>
                        <div class="power" id="arena-enemy-power">戰力: ???</div>
                    </div>
                </div>

                <div style="margin: 15px 0;">
                    <h3 style="margin:0 0 5px 0; font-size:1em; color:#e74c3c;">⚠️ 敵方佈署情報</h3>
                    <div id="enemy-preview-grid" class="defense-grid small-grid"></div>
                </div>

                <div style="margin: 15px 0;">
                    <h3 style="margin:0 0 5px 0; font-size:1em; color:#3498db;">⚔️ 我方進攻陣容</h3>
                    <div class="lanes-wrapper" style="background: rgba(52, 152, 219, 0.1); padding: 5px; border-radius: 5px;">
                        <div class="defense-grid small-grid">
                            <div class="lane-row">
                                <div class="defense-slot pvp-attack-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                            </div>
                            <div class="lane-row">
                                <div class="defense-slot pvp-attack-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                            </div>
                            <div class="lane-row">
                                <div class="defense-slot pvp-attack-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button id="back-to-list-btn" class="btn-secondary" style="flex: 1;">⬅️ 返回列表</button>
                    <button id="save-attack-team-btn" class="btn-secondary" style="flex: 1; background: #8e44ad;">💾 儲存陣容</button> 
                    <button id="start-pvp-battle-btn" class="btn-danger" style="flex: 2; font-size: 1.2em;">⚔️ 開戰 (奪取 5% 金幣)</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>