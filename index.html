<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ­·å²è‹±éˆï¼šç­–ç•¥å°æ±º</title>
    <meta name="google-site-verification" content="rUWOR0-82xcLnEEm-y9E4HnHyzsBxWXY9kK9DHXYD7Q" />
    <link rel="stylesheet" href="style.css?v=132">
    <style>
        /* --- å»ºç¯‰å‡ç´šé€²åº¦æ¢æ¨£å¼ --- */
        .build-progress-bar {
            width: 100%;
            height: 20px; 
            background-color: #444; 
            border-radius: 10px;
            margin-top: 8px;
            overflow: hidden;
            position: relative; 
            border: 1px solid #222;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        }
        .build-progress-bar .fill {
            height: 100%;
            background-color: #f1c40f; 
            width: 0%;
            transition: width 0.2s linear;
            box-shadow: 0 0 5px rgba(241, 196, 15, 0.5);
        }
        .timer-text {
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85em; color: #fff; font-weight: bold;
            text-shadow: 1px 1px 2px #000, -1px -1px 2px #000;
            z-index: 5; pointer-events: none; font-family: monospace;
        }

        /* --- å¸ƒé™£ç•«é¢æ¨£å¼ --- */
        .lanes-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            gap: 15px;
            padding: 20px 0;
            box-sizing: border-box;
            z-index: 10;
            position: relative;
        }

        .lane-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            width: auto;
        }

        .defense-slot {
            width: 100px;
            height: 150px;
            border: 2px dashed rgba(255, 255, 255, 0.4);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            position: relative;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .defense-slot:hover {
            border-color: #f1c40f;
            background: rgba(241, 196, 15, 0.1);
            transform: translateY(-3px);
        }

        .defense-slot.active {
            border: 2px solid #f39c12;
            background: none;
        }

        .deploy-card-info {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 5;
            text-shadow: 1px 1px 2px #000, -1px -1px 2px #000, 1px -1px 2px #000, -1px 1px 2px #000;
        }

        .deploy-info-top-left {
            position: absolute;
            top: 4px; left: 6px;
            font-size: 0.85em;
            color: #fff;
            font-weight: bold;
        }

        .deploy-info-top-right {
            position: absolute;
            top: 4px; right: 6px;
            font-size: 1.1em;
        }

        .deploy-power-tag {
            position: absolute;
            bottom: 24px; 
            left: 50%;
            transform: translateX(-50%);
            background: rgba(192, 57, 43, 0.9);
            color: #fff;
            font-size: 0.85em;
            padding: 1px 6px;
            border-radius: 4px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .deploy-info-bottom {
            position: absolute;
            bottom: 4px;
            width: 100%;
            text-align: center;
            color: #f1c40f;
            font-size: 1.1em;
            letter-spacing: 1px;
        }

        .slot-placeholder {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5em;
            color: rgba(255,255,255,0.3);
            font-weight: bold;
        }
    </style>
</head>
<body>

    <audio id="bgm" loop><source src="assets/sounds/bgm.mp3" type="audio/mpeg"></audio>
    <audio id="bgm-battle" loop><source src="assets/sounds/bgm-battle.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-draw"><source src="assets/sounds/draw.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-ssr"><source src="assets/sounds/ssr.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-reveal"><source src="assets/sounds/reveal.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-coin"><source src="assets/sounds/coin.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-upgrade"><source src="assets/sounds/upgrade.mp3" type="audio/mpeg"></audio>
    
    <div class="game-container">
        <h1>âš”ï¸ æ­·å²è‹±éˆï¼šç­–ç•¥å°æ±º</h1>

        <div id="login-section">
            <h3>è«‹é¸æ“‡ç™»å…¥æ–¹å¼ï¼š</h3>
            <div style="margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px;">
                <input type="email" id="email-input" placeholder="é›»å­ä¿¡ç®±">
                <input type="password" id="pass-input" placeholder="å¯†ç¢¼ (6ä½ä»¥ä¸Š)">
                <div style="text-align: right;">
                    <button id="forgot-pass-btn" style="background: none; border: none; color: #f1c40f; cursor: pointer; font-size: 0.9em; text-decoration: underline; padding: 0;">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</button>
                </div>
            </div>
            <div style="display: flex; justify-content: center;">
                <button id="email-login-btn" class="btn-secondary">ä¿¡ç®±ç™»å…¥</button>
                <button id="email-signup-btn" class="btn-secondary" style="background:#2ecc71;">è¨»å†Šæ–°å¸³è™Ÿ</button>
            </div>
            <hr style="margin: 20px 0; border-color: #555;">
            <button id="guest-btn" class="btn-secondary" style="background:#95a5a6; width: 100%;">ğŸ‘» éŠå®¢è©¦ç© (åŒ¿å)</button>
        </div>

        <div id="user-info" style="display:none; flex-direction:column; gap:10px;">
            <div style="display:flex; justify-content:space-between; width:100%; align-items:center; flex-wrap: wrap; gap: 10px;">
                <span id="user-name" style="font-size:1.2em; font-weight:bold;">ç©å®¶ï¼šè¼‰å…¥ä¸­...</span>
                <div style="display: flex; gap: 5px;">
                    <button id="notification-btn" class="btn-secondary" style="font-size: 0.9em; padding: 5px 10px; background: #e67e22;">
                        ğŸ”” é€šçŸ¥ <span id="notif-badge" class="notification-badge hidden">0</span>
                    </button>
                    <button id="gallery-btn" class="btn-secondary" style="font-size: 0.9em; padding: 5px 10px; background: #1abc9c;">ğŸ“– åœ–é‘‘</button>
                    <button id="settings-btn" class="btn-secondary" style="font-size: 0.9em; padding: 5px 10px;">âš™ï¸ è¨­å®š</button>
                    <button id="logout-btn" class="btn-secondary" style="font-size: 0.9em; padding: 5px 10px;">ç™»å‡º</button>
                </div>
            </div>
            <div><span id="power-display">ğŸ”¥ æˆ°åŠ›: 0</span></div>
        </div>
        
        <div id="game-ui" class="hidden">
            <div class="main-layout">
                <div class="game-area">
                    <div class="status-bar">
                        <div style="display:flex; flex-direction:column; gap:5px; width:100%;">
                            <div style="display:flex; justify-content:space-between; font-size: 0.95em; flex-wrap: wrap; gap: 3px;">
                                <span>ğŸ’ <span id="gem-count">0</span></span>
                                <span>ğŸ’° <span id="gold-count">0</span></span>
                                <span>ğŸŒ¾ <span id="food-count">0</span></span>
                                <span>ğŸŒ² <span id="wood-count">0</span></span>
                                <span>ğŸ”© <span id="iron-count">0</span></span>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button id="territory-btn" class="btn-secondary" style="background:#27ae60; flex:1; margin:0;">ğŸ° ç¶“ç‡Ÿé ˜åœ°</button>
                                <button id="inventory-btn" class="btn-secondary" style="background:#8e44ad; flex:1; margin:0;">ğŸ’ æˆ‘çš„èƒŒåŒ…</button>
                            </div>
                        </div>
                    </div>

                    <button id="enter-battle-mode-btn" class="btn-danger" style="width: 100%; margin-bottom: 10px; font-size: 1.2em; border: 2px solid #fff; box-shadow: 0 0 10px #c0392b;">âš”ï¸ å‰å¾€æˆ°å ´ (é¸æ“‡é—œå¡)</button>
                    
                    <button id="enter-adventure-mode-btn" class="btn-primary" style="width: 100%; margin-bottom: 20px; font-size: 1.2em; background: #e67e22; border: 2px solid #fff; box-shadow: 0 0 10px #d35400;">ğŸ² é€²å…¥å†’éšªæ¨¡å¼ (å‹•ä½œç‰ˆ)</button>

                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button id="pvp-menu-btn" class="btn-primary" style="flex: 1; background: #2980b9; border: 2px solid #fff;">ğŸ›¡ï¸ è¨­å®šé˜²å®ˆéšŠä¼</button>
                        <button id="pvp-search-btn" class="btn-secondary" style="flex: 1; background: #d35400; border: 2px solid #fff; box-shadow: 0 0 10px #e67e22;">ğŸ” å°‹æ‰¾å°æ‰‹</button>
                    </div>

                    <div class="gacha-section">
                        <button id="draw-btn" class="btn-primary">å–®æŠ½ (100é‘½)</button>
                        <button id="draw-10-btn" class="btn-secondary" style="display:flex; flex-direction:column; align-items:center; line-height:1.2;">
                            <span>åé€£ (1000é‘½)</span>
                            <span style="font-size:0.7em; color:#ffeaa7;">(å¿…å¾—1å¼µSRä»¥ä¸Šå¡ç‰‡)</span>
                        </button>
                    </div>
                </div>

                <div class="leaderboard-area">
                    <h2 style="margin-top:0; color:#f1c40f; text-align: center;">ğŸ† å…¨æœæˆ°åŠ›æ¦œ</h2>
                    <div id="leaderboard-list"><p style="text-align:center;">è¼‰å…¥ä¸­...</p></div>
                    <div class="studio-logo-container">
                        <img src="assets/logo.png" alt="Studio Logo" id="studio-logo">
                        <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 5px;">Designed by SoonYoung Studio</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="territory-modal" class="modal hidden">
        <div class="modal-content" style="background: #2c3e50; border: 3px solid #27ae60;">
            <div class="modal-header">
                <h2>ğŸ° æˆ‘çš„é ˜åœ°</h2>
                <button id="close-territory-btn" class="btn-primary" style="background:#c0392b;">é›¢é–‹</button>
            </div>
            <div class="territory-grid-container" style="flex: 1; overflow-y: auto; padding: 10px;">
                <div class="territory-grid"></div>
            </div>
        </div>
    </div>

    <div id="level-selection-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh;">
            <div class="modal-header">
                <h2>ğŸ—ºï¸ é¸æ“‡æˆ°å½¹é—œå¡</h2>
                <button id="close-level-select-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div class="level-grid">
                <button class="level-btn" data-level="1">ç¬¬ 1 ç« <br><span class="level-name">æ©«æƒå…­åœ‹</span></button>
                <button class="level-btn" data-level="2">ç¬¬ 2 ç« <br><span class="level-name">ç„¡æ•—ä¹‹ç‹</span></button>
                <button class="level-btn" data-level="3">ç¬¬ 3 ç« <br><span class="level-name">æ”¹å¯«ä¸–ç•Œçš„äºº</span></button>
                <button class="level-btn" data-level="4">ç¬¬ 4 ç« <br><span class="level-name">ç„¡æ³•é˜»æ“‹çš„éµè¹„</span></button>
                <button class="level-btn" data-level="5">ç¬¬ 5 ç« <br><span class="level-name">æˆ‘ä¾† æˆ‘è¦‹ æˆ‘å¾æœ</span></button>
                <button class="level-btn" data-level="6">ç¬¬ 6 ç« <br><span class="level-name">æˆ°è±¡ç¿»å±±</span></button>
                <button class="level-btn" data-level="7">ç¬¬ 7 ç« <br><span class="level-name">å¸åœ‹çš„é­…å½±</span></button>
                <button class="level-btn" data-level="8">ç¬¬ 8 ç« <br><span class="level-name">æ±ºæˆ°å·–æµå³¶</span></button>
            </div>
        </div>
    </div>

    <div id="battle-screen" class="hidden">
        <div class="battle-header">
            <div class="battle-info">
                <span id="level-title-display" style="color: #fff; margin-right: 10px; font-weight: bold; color: #f1c40f;"></span>
                <span>âš”ï¸ å­˜æ´»: <span id="hero-count-display">0</span></span>
                <span id="wave-display-container">ğŸ’€ æ³¢æ¬¡: <span id="wave-count">1</span>/4</span>
                <span id="battle-gold-container">ğŸ’° <span id="battle-gold">0</span> G</span>
                <span id="battle-food-cost-container" style="margin-left: 10px; color: #e67e22; display: none; font-weight: bold;">ğŸŒ¾ -<span id="battle-food-cost">0</span></span>
                <span style="margin-left: 10px; color: #f39c12;">ğŸ”¥ <span id="current-battle-power">0</span></span>
            </div>
            <button id="retreat-btn" class="btn-danger" style="padding: 5px 15px; font-size: 0.9em;">ğŸ³ï¸ æ’¤é€€</button>
        </div>

        <div class="battle-content-wrapper" style="flex: 1; display: flex; overflow: hidden; position: relative;">
            <div class="battle-field-container">
                <div id="wave-notification" class="hidden">ç¬¬ 1 æ³¢</div>
                <div class="spawn-line left"></div>
                <div id="hero-container"></div>
                <div class="lanes-wrapper" style="opacity: 0.3;">
                    <div class="lane-row" id="lane-0">
                        <div class="defense-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                    </div>
                    <div class="lane-row" id="lane-1">
                        <div class="defense-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                    </div>
                    <div class="lane-row" id="lane-2">
                        <div class="defense-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                        <div class="defense-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                    </div>
                </div>
                <div id="enemy-container"></div>
            </div>
            <button id="toggle-sidebar-btn">â–¶</button>
            <div class="battle-monitor-sidebar">
                <h3 style="margin: 0 0 10px 0; color: #f1c40f; border-bottom: 1px solid #555; padding-bottom: 5px;">ğŸ›¡ï¸ æˆ‘æ–¹ç‹€æ…‹</h3>
                <div id="hero-monitor-list"></div>
                <h3 style="margin: 15px 0 10px 0; color: #e74c3c; border-bottom: 1px solid #555; padding-bottom: 5px;">ğŸ’€ æ•µæ–¹ç‹€æ…‹</h3>
                <div id="enemy-monitor-list"></div>
            </div>
        </div>

        <div class="battle-deck">
            <div id="difficulty-controls" style="display:flex; justify-content:center; gap:10px; margin-bottom:5px;">
                <button class="difficulty-btn" data-diff="easy" style="background:#2ecc71;">ğŸŸ¢ ç°¡å–®</button>
                <button class="difficulty-btn active" data-diff="normal" style="background:#f39c12;">ğŸŸ¡ æ™®é€š</button>
                <button class="difficulty-btn" data-diff="hard" style="background:#e74c3c;">ğŸ”´ å›°é›£</button>
            </div>
            <div style="display: flex; gap: 10px; width: 95%; margin: 0 auto; align-items: center;">
                <button id="auto-deploy-btn" class="btn-secondary" style="flex: 1; padding: 10px; font-size: 1em; background: #8e44ad;">âš¡ è‡ªå‹•</button>
                <button id="clear-deploy-btn" class="btn-secondary" style="flex: 0.5; padding: 10px; font-size: 1em; background: #95a5a6;">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button id="speed-btn" class="btn-secondary" style="flex: 0.5; padding: 10px; font-size: 1em; background: #f39c12;">â© 1x</button>
                <button id="start-battle-btn" class="btn-primary btn-disabled" style="flex: 2; padding: 10px; font-size: 1.2em;">è«‹å…ˆéƒ¨ç½²è‹±é›„</button>
            </div>
        </div>
    </div>

    <div id="battle-result-modal" class="hidden">
        <div class="result-content">
            <div id="result-title" class="result-title">VICTORY</div>
            <div id="result-desc" style="color:#ccc; margin-bottom:5px;">æˆ°é¬¥çå‹µ</div>
            <div id="result-gold" class="result-gold">ğŸ’° +0</div>
            <div id="result-gems" class="result-gold" style="color:#2ecc71;">ğŸ’ +0</div>
            <div id="dps-chart" class="dps-container"></div>
            <button id="close-result-btn" class="btn-primary" style="width:100%; margin-top: 15px;">å›åˆ°å¤§å»³</button>
        </div>
    </div>

    <div id="inventory-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display:flex; align-items:center; gap:5px; flex-wrap:wrap;">
                    <h2 id="inventory-title">ğŸ’ èƒŒåŒ…</h2>
                    <button id="auto-star-btn" class="btn-secondary" style="background:#2ecc71; font-size: 0.8em; padding: 5px;">âš¡ ä¸€éµå‡æ˜Ÿ</button>
                    <button id="inventory-clear-btn" class="btn-secondary" style="background:#e74c3c; font-size: 0.8em; padding: 5px;">ğŸ—‘ï¸ è§£é™¤å…¨è»</button>
                    <select id="sort-select" class="sort-dropdown">
                        <option value="time_desc">ğŸ“… ç²å¾—æ™‚é–“</option>
                        <option value="power_desc">ğŸ”¥ ä¾æˆ°åŠ›</option>
                        <option value="rarity_desc">ğŸ’ ä¾ç¨€æœ‰åº¦</option>
                        <option value="id_asc">ğŸ”¢ å¡ç‰‡åºè™Ÿ</option>
                    </select>
                    <button id="batch-toggle-btn" style="font-size: 0.8em;">ğŸ”§ æ‰¹é‡</button>
                </div>
                <button id="close-inventory-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="ALL">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="SSR">SSR</button>
                <button class="filter-btn" data-filter="SR">SR</button>
                <button class="filter-btn" data-filter="R">R</button>
                <button class="filter-btn" data-filter="INFANTRY">âš”ï¸ æ­¥å…µ</button>
                <button class="filter-btn" data-filter="CAVALRY">ğŸ´ é¨å…µ</button>
                <button class="filter-btn" data-filter="ARCHER">ğŸ¹ å¼“å…µ</button>
            </div>
            <div id="inventory-grid" class="card-container" style="justify-content: flex-start;"></div>
            <div id="batch-action-bar" class="hidden">
                <div id="batch-info">å·²é¸ 0 å¼µï¼Œç²å¾— 0 G</div>
                <button id="batch-confirm-btn">ç¢ºèªåˆ†è§£</button>
            </div>
        </div>
    </div>

    <div id="gallery-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display:flex; align-items:center; gap:5px; flex-wrap:wrap;">
                    <h2>ğŸ“– è‹±é›„åœ–é‘‘</h2>
                    <span id="gallery-progress" style="font-size: 0.9em; color: #f1c40f;">(æ”¶é›†é€²åº¦: 0/0)</span>
                </div>
                <button id="close-gallery-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div class="filter-bar" style="justify-content: center; gap: 5px; flex-wrap: wrap;">
                <button class="gallery-filter-btn active" data-filter="ALL">å…¨éƒ¨</button>
                <button class="gallery-filter-btn" data-filter="SSR">SSR</button>
                <button class="gallery-filter-btn" data-filter="SR">SR</button>
                <button class="gallery-filter-btn" data-filter="R">R</button>
                <button class="gallery-filter-btn" data-filter="INFANTRY">âš”ï¸ æ­¥å…µ</button>
                <button class="gallery-filter-btn" data-filter="CAVALRY">ğŸ´ é¨å…µ</button>
                <button class="gallery-filter-btn" data-filter="ARCHER">ğŸ¹ å¼“å…µ</button>
            </div>
            <div id="gallery-grid" class="card-container" style="justify-content: flex-start;"></div>
        </div>
    </div>

    <div id="notification-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px; height: auto; max-height: 80vh;">
            <div class="modal-header">
                <h2>ğŸ”” ç³»çµ±é€šçŸ¥</h2>
                <button id="close-notification-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div id="notification-list" style="overflow-y: auto; text-align: left;"></div>
        </div>
    </div>

    <div id="detail-modal" class="modal hidden" style="background: rgba(0,0,0,0.95);">
        <button id="close-detail-btn" class="btn-close-circle">âœ•</button>
        <button id="prev-card-btn" class="nav-arrow left">â®</button>
        <button id="next-card-btn" class="nav-arrow right">â¯</button>
        <div id="large-card-view" class="large-card-container"></div>
        <div class="upgrade-controls">
            <div class="upgrade-box">
                <div class="upgrade-title">æå‡ç­‰ç´š (Lv.30 Max)</div>
                <button id="upgrade-level-btn" class="btn-upgrade">â¬†ï¸ å‡ç´š</button>
            </div>
            <div class="upgrade-box">
                <div class="upgrade-title">æå‡æ˜Ÿç´š (5â˜… Max)</div>
                <div style="font-size:0.8em; color:#aaa; margin-bottom:5px;">éœ€æ¶ˆè€— 1 å¼µåŒåå¡ç‰‡</div>
                <button id="upgrade-star-btn" class="btn-star">â­ å‡æ˜Ÿ</button>
            </div>
        </div>
        <div style="margin-top: 15px; z-index: 102;">
            <button id="dismantle-btn" class="btn-danger">ğŸ’° åˆ†è§£æ­¤å¡</button>
        </div>
    </div>

    <div id="gacha-reveal-modal" class="modal hidden" style="background: rgba(0,0,0,0.98); z-index: 2000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h2 style="color: #f1c40f; margin-bottom: 20px; text-shadow: 0 0 10px #000;">ğŸ‰ å¬å–šçµæœ</h2>
        <div id="gacha-reveal-container" class="gacha-result-grid"></div>
        
        <div style="margin-top: 30px; display:flex; gap: 20px;">
            <div id="gacha-next-hint" style="color: #aaa; font-size: 0.9em;">(é»æ“Šå¡ç‰‡å¯æŸ¥çœ‹è©³æƒ…)</div>
        </div>
        
        <button id="gacha-close-btn" class="btn-primary" style="margin-top: 20px; font-size: 1.2em; padding: 10px 40px; border: 2px solid white; box-shadow: 0 0 15px #f1c40f;">
            å…¨éƒ¨æ”¶ä¸‹
        </button>
    </div>

    <div id="gacha-overlay" class="hidden">
        <div id="summon-burst"></div>
        <div id="summon-circle"></div>
        <h2 id="summon-text" style="color: white; margin-top: 20px; letter-spacing: 5px;">å¬å–šä¸­...</h2>
    </div>

    <div id="settings-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px; height: auto;">
            <div class="modal-header">
                <h2>âš™ï¸ éŠæˆ²è¨­å®š</h2>
                <button id="close-settings-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div class="settings-body">
                <div class="setting-item">
                    <label>ç©å®¶æš±ç¨±</label>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="settings-name-input" placeholder="è¼¸å…¥æ–°æš±ç¨±" style="flex:1;">
                        <button id="settings-save-name-btn" class="btn-primary">å„²å­˜</button>
                    </div>
                </div>
                <div class="setting-item">
                    <label>ğŸ è¼¸å…¥åºè™Ÿ</label>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="redeem-code-input" placeholder="è¼¸å…¥åºè™Ÿé ˜ç" style="flex:1;">
                        <button id="redeem-btn" class="btn-secondary" style="background:#8e44ad;">å…Œæ›</button>
                    </div>
                </div>
                <hr style="border-color: #555; margin: 15px 0;">
                <div class="setting-item" id="account-bind-section">
                    <label>ğŸ” å¸³è™Ÿå®‰å…¨ (éŠå®¢ç¶å®š)</label>
                    <div id="bind-form-container">
                        <p style="font-size:0.8em; color:#bdc3c7; margin-bottom:5px;">ç¶å®šä¿¡ç®±ä»¥é˜²è³‡æ–™éºå¤±ã€‚</p>
                        <input type="email" id="bind-email-input" placeholder="è¼¸å…¥é›»å­éƒµä»¶" style="width:100%; margin-bottom:5px;">
                        <input type="password" id="bind-pass-input" placeholder="è¨­å®šå¯†ç¢¼ (è‡³å°‘6ç¢¼)" style="width:100%;">
                        <button id="bind-account-btn" class="btn-primary" style="width:100%; margin-top:5px; background-color:#3498db;">ç¶å®šå¸³è™Ÿ</button>
                    </div>
                    <div id="bind-status-container" class="hidden" style="background:rgba(0,0,0,0.3); padding:10px; border-radius:5px; text-align:center;">
                        <div style="color:#2ecc71; font-weight:bold; margin-bottom:5px;">âœ” å·²ç¶å®šå¸³è™Ÿ</div>
                        <div id="current-bind-email" style="font-size:0.9em; color:#fff;"></div>
                    </div>
                </div>
                <hr style="border-color: #555; margin: 15px 0;">
                <div class="setting-item">
                    <label>èƒŒæ™¯éŸ³æ¨‚ (BGM)</label>
                    <div class="control-row">
                        <input type="checkbox" id="bgm-toggle" checked> <span id="bgm-status">é–‹å•Ÿ</span>
                    </div>
                    <input type="range" id="bgm-volume" min="0" max="1" step="0.1" value="0.5" style="width:100%;">
                </div>
                <div class="setting-item">
                    <label>éŠæˆ²éŸ³æ•ˆ (SFX)</label>
                    <div class="control-row">
                        <input type="checkbox" id="sfx-toggle" checked> <span id="sfx-status">é–‹å•Ÿ</span>
                    </div>
                    <input type="range" id="sfx-volume" min="0" max="1" step="0.1" value="1.0" style="width:100%;">
                </div>
            </div>
        </div>
    </div>

    <div id="pvp-setup-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>ğŸ›¡ï¸ ä½ˆç½²é˜²å®ˆè»éšŠ</h2>
                <button id="close-pvp-modal-btn" class="btn-primary" style="background:#c0392b;">é—œé–‰</button>
            </div>
            <div style="color: #ccc; font-size: 0.9em; margin-bottom: 10px; text-align: center;">
                è«‹åœ¨ 3x3 çš„æ–¹æ ¼ä¸­é…ç½®æ‚¨çš„é˜²å®ˆé™£å‹ (æœ€å¤š 6 äºº)<br>
                <span style="color: #f1c40f;">å·¦å´ç‚ºå‰æ’ï¼Œå³å´ç‚ºå¾Œæ’</span>
            </div>
            <div class="pvp-grid-container" style="background: #34495e; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                <div class="lane-row">
                    <div class="defense-slot pvp-defense-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                </div>
                <div class="lane-row" style="margin: 10px 0;">
                    <div class="defense-slot pvp-defense-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                </div>
                <div class="lane-row">
                    <div class="defense-slot pvp-defense-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                    <div class="defense-slot pvp-defense-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                </div>
            </div>
            <button id="save-pvp-team-btn" class="btn-upgrade" style="width: 100%; font-size: 1.2em; padding: 15px;">ğŸ’¾ å„²å­˜é˜²å®ˆé™£å®¹</button>
        </div>
    </div>

    <div id="pvp-arena-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px; background: #2c3e50; border: 3px solid #e74c3c; height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 style="color: #e74c3c;">âš”ï¸ PVP ç«¶æŠ€å ´</h2>
                <button id="close-arena-btn" class="btn-primary" style="background:#7f8c8d;">é›¢é–‹</button>
            </div>
            <div id="pvp-loading" class="hidden" style="text-align: center; padding: 50px;">
                <div style="font-size: 3em; animation: spin 1s infinite linear;">ğŸ”</div>
                <h3>æ­£åœ¨æœå°‹æ——é¼“ç›¸ç•¶çš„å°æ‰‹...</h3>
            </div>
            <div id="pvp-opponent-list-view" class="hidden" style="padding: 10px;">
                <button id="refresh-opponent-btn" class="btn-secondary" style="margin-bottom:15px; width: 100%;">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                <h3 style="text-align:center; color:#f1c40f; margin-top: 0;">è«‹é¸æ“‡æŒ‘æˆ°å°æ‰‹</h3>
                <div id="pvp-opponent-list" class="opponent-list-container"></div>
            </div>
            <div id="pvp-match-content" class="hidden" style="padding-bottom: 20px;">
                <div class="vs-container" style="padding: 10px;">
                    <div class="player-card self">
                        <div class="p-name" id="arena-my-name">æˆ‘æ–¹</div>
                        <div class="p-power">æˆ°åŠ›: <span id="arena-my-power">0</span></div>
                    </div>
                    <div class="vs-logo" style="font-size: 2em; margin: 0 10px;">VS</div>
                    <div class="player-card enemy">
                        <div class="p-name" id="arena-enemy-name">???</div>
                        <div class="p-power">æˆ°åŠ›: <span id="arena-enemy-power">???</span></div>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 20px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; border: 1px solid #e74c3c;">
                        <h3 style="text-align: center; color: #e74c3c; margin: 0 0 10px 0;">âš ï¸ æ•µæ–¹é˜²å®ˆä½ˆç½²</h3>
                        <div id="enemy-preview-grid" class="pvp-grid-container readonly"></div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; border: 1px solid #3498db;">
                        <h3 style="text-align: center; color: #3498db; margin: 0 0 10px 0;">âš”ï¸ æˆ‘æ–¹é€²æ”»ä½ˆç½² (é»æ“Šé…ç½®)</h3>
                        <div class="pvp-grid-container" id="my-attack-grid" style="background: #2c3e50;">
                            <div class="lane-row">
                                <div class="defense-slot pvp-attack-slot" data-slot="0"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="1"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="2"><div class="slot-placeholder">+</div></div>
                            </div>
                            <div class="lane-row" style="margin: 10px 0;">
                                <div class="defense-slot pvp-attack-slot" data-slot="3"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="4"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="5"><div class="slot-placeholder">+</div></div>
                            </div>
                            <div class="lane-row">
                                <div class="defense-slot pvp-attack-slot" data-slot="6"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="7"><div class="slot-placeholder">+</div></div>
                                <div class="defense-slot pvp-attack-slot" data-slot="8"><div class="slot-placeholder">+</div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="back-to-list-btn" class="btn-secondary" style="flex: 1;">â¬…ï¸ è¿”å›åˆ—è¡¨</button>
                    <button id="save-attack-team-btn" class="btn-secondary" style="flex: 1; background: #8e44ad;">ğŸ’¾ å„²å­˜é™£å®¹</button> 
                    <button id="start-pvp-battle-btn" class="btn-danger" style="flex: 2; font-size: 1.2em;">âš”ï¸ é–‹æˆ° (å¥ªå– 5% é‡‘å¹£)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="adventure-prep-modal" class="modal hidden" style="z-index: 2500;">
        <div class="modal-content" style="max-width: 900px; height: 90%; background: #2c3e50; border: 2px solid #e67e22; display:flex; flex-direction:column;">
            
<div class="modal-header">
    <h2>â›º å†’éšªè€…ç‡Ÿåœ°</h2>
    <div style="font-size: 0.9em; color: #ccc;">
        ğŸ’ <span id="prep-gem-amount">0</span> | ğŸ’° <span id="prep-gold-amount">0</span>
    </div>
    <button id="close-prep-btn" class="btn-primary" style="background:#c0392b;">è¿”å›å¤§å»³</button>
</div>

            <div class="prep-container" style="flex:1; display:flex; overflow:hidden; gap: 10px;">
                
                <div class="prep-hero-panel">
                    <div class="prep-hero-preview">
                        <img id="prep-hero-img" src="assets/hero/hero_unarmed.png" style="height: 120px; object-fit: contain;">
                        <div class="prep-stats">
                            <div>âš”ï¸ æ”»æ“Š: <span id="prep-atk">0</span></div>
                            <div>â¤ï¸ ç”Ÿå‘½: <span id="prep-hp">0</span></div>
                        </div>
                    </div>

                    <div class="prep-equip-grid">
                        <div class="equip-slot" data-type="weapon" title="æ­¦å™¨">âš”ï¸ <div class="slot-label">æ­¦å™¨</div></div>
                        <div class="equip-slot" data-type="head" title="é ­ç›”">ğŸª– <div class="slot-label">é ­ç›”</div></div>
                        <div class="equip-slot" data-type="armor" title="ç›”ç”²">ğŸ›¡ï¸ <div class="slot-label">ç›”ç”²</div></div>
                        <div class="equip-slot" data-type="gloves" title="æ‰‹å¥—">ğŸ§¤ <div class="slot-label">æ‰‹å¥—</div></div>
                        <div class="equip-slot" data-type="legs" title="è­·è…¿">ğŸ‘– <div class="slot-label">è­·è…¿</div></div>
                        <div class="equip-slot" data-type="shoes" title="é‹å­">ğŸ‘ <div class="slot-label">é‹å­</div></div>
                    </div>

                    <div class="prep-slots-title" style="margin-top: 10px; font-weight:bold; color:#f1c40f;">ğŸ’ æ”œå¸¶å¡ç‰‡ (æŠ€èƒ½)</div>
                    <div class="prep-card-slots" id="prep-card-slots">
                        </div>
                    
                    <div class="prep-slots-title" style="margin-top:5px; font-weight:bold; color:#f1c40f;">ğŸ§ª æ”œå¸¶é“å…·</div>
                    <div class="prep-item-slots">
                        <div class="item-slot empty">+</div>
                        <div class="item-slot empty">+</div>
                        <div class="item-slot empty">+</div>
                    </div>
                </div>

                <div class="prep-action-panel">
                    <div class="prep-tabs">
                        <button class="prep-tab-btn active" data-tab="equip">ğŸ’ è£å‚™åº«</button>
                        <button class="prep-tab-btn" data-tab="shop">ğŸ›’ é›œè²¨åº—</button>
                        <button class="prep-tab-btn" data-tab="gacha">ğŸ”® è£å‚™å¬å–š</button>
                        <button class="prep-tab-btn" data-tab="level">ğŸ—ºï¸ é¸æ“‡é—œå¡</button>
                    </div>

                    <div id="tab-equip" class="prep-tab-content active">
                        <div class="prep-grid-list" id="prep-equip-list">
                            <p style="color:#aaa; text-align:center; width:100%;">æš«ç„¡è£å‚™</p>
                        </div>
                    </div>

                    <div id="tab-shop" class="prep-tab-content">
                        <div class="shop-grid">
                            <div class="shop-item">
                                <div class="shop-icon">ğŸ§ª</div>
                                <div class="shop-name">å°ç´…è—¥æ°´</div>
                                <button class="btn-mini">500 G</button>
                            </div>
                            <div class="shop-item">
                                <div class="shop-icon">âš”ï¸</div>
                                <div class="shop-name">è¨“ç·´æœ¨åŠ</div>
                                <button class="btn-mini">1000 G</button>
                            </div>
                        </div>
                    </div>

                    <div id="tab-gacha" class="prep-tab-content">
                        <div style="text-align:center; padding:20px;">
                            <h3>âœ¨ ç¥ç§˜éµåŒ èˆ– âœ¨</h3>
                            <p style="color:#f1c40f; margin-bottom:20px;">æ¶ˆè€—é‘½çŸ³æŠ½å–å¼·åŠ›è£å‚™ï¼</p>
                            <button class="btn-primary" style="font-size:1.2em;">ğŸ”¨ é›é€ ä¸€æ¬¡ (200 ğŸ’)</button>
                            <button class="btn-secondary" style="font-size:1.2em;">ğŸ”¨ åé€£é›é€  (1800 ğŸ’)</button>
                        </div>
                    </div>

                    <div id="tab-level" class="prep-tab-content">
                        <div class="level-select-grid">
                            <button class="prep-level-btn selected" data-lv="1">ç¬¬ 1 ç« ï¼šæ£®æ—é‚Šå¢ƒ</button>
                            <button class="prep-level-btn" data-lv="2">ç¬¬ 2 ç« ï¼šè’é‡</button>
                            <button class="prep-level-btn locked" data-lv="3">ç¬¬ 3 ç« ï¼šåœ°ä¸‹åŸ</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="prep-footer">
                <button id="prep-start-battle-btn" class="btn-danger" style="width: 100%; padding: 15px; font-size: 1.5em; border: 2px solid #fff; box-shadow: 0 0 15px #c0392b;">âš”ï¸ å‡ºç™¼å†’éšª</button>
            </div>
        </div>
    </div>

    <div id="adventure-screen" class="hidden">
        <canvas id="adv-canvas"></canvas>
        
        <div id="adv-ui-layer">
            <div class="adv-top-bar">
                <div class="adv-player-info">
                    <div class="adv-avatar">ğŸ‘¤</div>
                    <div class="adv-bars">
                        <div class="adv-hp-bar"><div id="adv-hp-fill" style="width: 100%;"></div></div>
                        <div class="adv-mp-bar"><div style="width: 100%;"></div></div>
                    </div>
                </div>
                <button id="adv-exit-btn" class="btn-danger" style="padding: 5px 15px;">ğŸ³ï¸ é€€å‡ºå†’éšª</button>
            </div>

            <div id="adv-skill-bar-container"></div>

            <div id="virtual-joystick-zone">
                <div id="joystick-base">
                    <div id="joystick-stick"></div>
                </div>
            </div>

            <div class="adv-controls-hint">
                é›»è…¦ï¼šWASD ç§»å‹•<br>
                æ‰‹æ©Ÿï¼šå·¦ä¸‹è§’æ–æ¡¿
            </div>
        </div>
    </div>

    <script type="module" src="js/inventory.js"></script>
    <script type="module" src="js/territory.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>